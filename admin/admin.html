<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar | Enactus FTU Hanoi Recruitment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Clash+Display:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        /* CSS từ dashboard.html - giữ nguyên */
        :root {
            --primary: #F8F3CE;
            --primary-light: #FFD54F;
            --gray-50: #FAFAFA;
            --gray-100: #F5F5F5;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            --white: #FFFFFF;
            --error: #EF4444;
            --error-light: #FEE2E2;
            --success: #10B981;
            --success-light: #D1FAE5;
            --warning: #F59E0B;
            --warning-light: #FEF3C7;
            --info: #3B82F6;
            --info-light: #DBEAFE;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        body {
            background-color: var(--gray-50);
            color: var(--gray-800);
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar - giữ nguyên từ dashboard */
        .sidebar {
            width: 260px;
            background: var(--white);
            box-shadow: var(--shadow);
            padding: 24px 0;
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: var(--transition);
        }

        .logo {
            padding: 0 24px 24px;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 24px;
        }

        .logo img {
            height: 60px;
            width: auto;
            display: block;
            margin: 0 auto;
        }

        .nav-menu {
            flex: 1;
        }

        .nav-item {
            padding: 12px 24px;
            display: flex;
            align-items: center;
            color: var(--gray-600);
            text-decoration: none;
            transition: var(--transition);
            margin-bottom: 4px;
            cursor: pointer;
        }

        .nav-item:hover, .nav-item.active {
            background-color: var(--primary);
            color: var(--gray-900);
        }

        .nav-item i {
            margin-right: 12px;
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .nav-item span {
            font-weight: 500;
        }

        .user-section {
            padding: 16px 24px;
            border-top: 1px solid var(--gray-200);
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: 600;
            color: var(--gray-800);
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-800);
        }

        .user-role {
            font-size: 12px;
            color: var(--gray-500);
        }

        .logout-btn {
            width: 100%;
            padding: 10px;
            background-color: var(--gray-100);
            border: none;
            border-radius: var(--border-radius);
            color: var(--gray-700);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logout-btn:hover {
            background-color: var(--error-light);
            color: var(--error);
        }

        .logout-btn i {
            margin-right: 8px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        .header {
            background-color: var(--white);
            padding: 16px 24px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
        }

        .page-title {
            font-family: 'Clash Display', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .refresh-btn, .export-btn, .create-btn {
            padding: 8px 16px;
            background-color: var(--gray-100);
            border: none;
            border-radius: var(--border-radius);
            color: var(--gray-700);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
        }

        .refresh-btn:hover, .export-btn:hover, .create-btn:hover {
            background-color: var(--gray-200);
        }

        .refresh-btn i, .export-btn i, .create-btn i {
            margin-right: 8px;
        }

        .create-btn {
            background-color: var(--primary-light);
            color: var(--gray-800);
        }

        .create-btn:hover {
            background-color: var(--primary);
        }

        /* Content */
        .content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        /* Calendar Selector */
        .calendar-selector {
            background-color: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .calendar-selector select {
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 14px;
            background-color: var(--white);
            color: var(--gray-800);
            min-width: 200px;
        }

        /* Filters */
        .filters {
            background-color: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--gray-700);
        }

        .filter-select, .filter-input {
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 14px;
            background-color: var(--white);
            color: var(--gray-800);
        }

        /* Calendar View */
        .calendar-view {
            display: flex;
            gap: 24px;
        }

        .calendar-week {
            flex: 1;
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background-color: var(--gray-100);
            border-bottom: 1px solid var(--gray-200);
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .calendar-nav button {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--gray-600);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .calendar-nav button:hover {
            background-color: var(--gray-200);
        }

        .calendar-week-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background-color: var(--gray-100);
            border-bottom: 1px solid var(--gray-200);
        }

        .calendar-week-day {
            padding: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-700);
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-auto-rows: 120px;
        }

        .calendar-day {
            border-right: 1px solid var(--gray-200);
            border-bottom: 1px solid var(--gray-200);
            padding: 8px;
            overflow-y: auto;
        }

        .calendar-day:last-child {
            border-right: none;
        }

        .calendar-day-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .day-number {
            font-weight: 600;
            color: var(--gray-800);
        }

        .day-events {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .day-event {
            background-color: var(--info-light);
            border-radius: 4px;
            padding: 4px 6px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .day-event:hover {
            background-color: var(--info);
            color: var(--white);
        }

        /* Events List */
        .events-list {
            width: 300px;
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .events-header {
            padding: 16px 20px;
            background-color: var(--gray-100);
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .events-title {
            font-weight: 600;
            color: var(--gray-800);
        }

        .add-event-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--gray-600);
            padding: 4px;
            border-radius: 4px;
        }

        .add-event-btn:hover {
            background-color: var(--gray-200);
        }

        .events-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .event-item {
            background-color: var(--gray-50);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .event-item:hover {
            background-color: var(--gray-100);
        }

        .event-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .event-title {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        .event-department {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 500;
            background-color: var(--info-light);
            color: var(--info);
        }

        .event-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 500;
        }

        .status-active {
            background-color: var(--success-light);
            color: var(--success);
        }

        .status-completed {
            background-color: var(--gray-200);
            color: var(--gray-600);
        }

        .status-hidden {
            background-color: var(--warning-light);
            color: var(--warning);
        }

        .event-details {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: 8px;
        }

        .event-slots {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray-500);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 20px;
        }

        .modal-tab {
            padding: 12px 24px;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
        }

        .modal-tab:hover {
            color: var(--gray-800);
        }

        .modal-tab.active {
            color: var(--info);
            border-bottom: 2px solid var(--info);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--gray-700);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 14px;
            background-color: var(--white);
            color: var(--gray-800);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-checkbox input {
            width: auto;
        }

        .slot-item {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 12px;
            align-items: end;
            margin-bottom: 12px;
            padding: 12px;
            background-color: var(--gray-50);
            border-radius: var(--border-radius);
        }

        .remove-slot {
            background: none;
            border: none;
            color: var(--error);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }

        .remove-slot:hover {
            background-color: var(--error-light);
        }

        .add-slot-btn {
            padding: 8px 16px;
            background-color: var(--gray-100);
            border: none;
            border-radius: var(--border-radius);
            color: var(--gray-700);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .add-slot-btn:hover {
            background-color: var(--gray-200);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary {
            background-color: var(--info);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: #2563eb;
        }

        .btn-secondary {
            background-color: var(--gray-100);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background-color: var(--gray-200);
        }

        /* Event Detail Modal */
        .event-detail-tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 20px;
        }

        .event-detail-tab {
            padding: 12px 24px;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
        }

        .event-detail-tab:hover {
            color: var(--gray-800);
        }

        .event-detail-tab.active {
            color: var(--info);
            border-bottom: 2px solid var(--info);
        }

        .event-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .event-info-item {
            display: flex;
            flex-direction: column;
        }

        .event-info-label {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 4px;
        }

        .event-info-value {
            font-weight: 500;
            color: var(--gray-800);
        }

        .slots-container {
            margin-bottom: 20px;
        }

        .slot-card {
            background-color: var(--gray-50);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 12px;
        }

        .slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .slot-title {
            font-weight: 600;
            color: var(--gray-800);
        }

        .slot-votes {
            font-size: 12px;
            color: var(--gray-600);
        }

        .slot-candidates {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .candidate-badge {
            background-color: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 16px;
            padding: 4px 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .candidates-container {
            margin-bottom: 20px;
        }

        .candidate-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid var(--gray-200);
        }

        .candidate-info {
            display: flex;
            flex-direction: column;
        }

        .candidate-name {
            font-weight: 500;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        .candidate-email {
            font-size: 12px;
            color: var(--gray-600);
        }

        .candidate-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 500;
        }

        .status-pending {
            background-color: var(--warning-light);
            color: var(--warning);
        }

        .status-voted {
            background-color: var(--info-light);
            color: var(--info);
        }

        .status-delayed {
            background-color: var(--error-light);
            color: var(--error);
        }

        .status-checkin {
            background-color: var(--primary);
            color: var(--gray-800);
        }

        .status-interviewed {
            background-color: var(--success-light);
            color: var(--success);
        }

        .status-selected {
            background-color: var(--info);
            color: var(--white);
        }

        .candidate-actions {
            display: flex;
            gap: 8px;
        }

        /* Keep Track */
        .keep-track-container {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .keep-track-header {
            padding: 16px 20px;
            background-color: var(--gray-100);
            border-bottom: 1px solid var(--gray-200);
        }

        .keep-track-title {
            font-weight: 600;
            color: var(--gray-800);
        }

        .keep-track-table {
            width: 100%;
            border-collapse: collapse;
        }

        .keep-track-table th {
            background-color: var(--gray-100);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 14px;
            border-bottom: 1px solid var(--gray-200);
        }

        .keep-track-table td {
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            font-size: 14px;
            color: var(--gray-700);
        }

        .keep-track-table tr:last-child td {
            border-bottom: none;
        }

        .interview-progress {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .progress-circle {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
        }

        .progress-circle.active {
            background-color: var(--info);
            color: var(--white);
            animation: pulse 2s infinite;
        }

        .progress-circle.completed {
            background-color: var(--success);
            color: var(--white);
        }

        .progress-circle.pending {
            background-color: var(--gray-300);
            color: var(--gray-600);
        }

        .progress-label {
            font-size: 10px;
            color: var(--gray-600);
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 80px;
            }
            
            .nav-item span {
                display: none;
            }
            
            .user-details {
                display: none;
            }
            
            .calendar-view {
                flex-direction: column;
            }
            
            .events-list {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .filters {
                grid-template-columns: 1fr;
            }
            
            .event-info-grid {
                grid-template-columns: 1fr;
            }
            
            .slot-item {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <img src="/assets/logo_den.png" alt="Enactus FTU Hanoi Logo">
        </div>
        
        <div class="nav-menu">
            <div class="nav-item" onclick="window.location.href='dashboard.html'">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item active" data-tab="calendar">
                <i class="fas fa-calendar-alt"></i>
                <span>Calendar</span>
            </div>
            <div class="nav-item system-settings-menu" style="display: none;" onclick="window.location.href='response.html'">
                <i class="fas fa-folder-open"></i>
                <span>Response</span>
            </div>
            <div class="nav-item keep-track-menu" style="display: none;" data-tab="keep-track">
                <i class="fas fa-chart-line"></i>
                <span>Keep Track</span>
            </div>
            <div class="nav-item system-settings-menu" style="display: none;" onclick="window.location.href='accounts.html'">
                <i class="fas fa-cog"></i>
                <span>Cấp quyền</span>
            </div>
        </div>
        
        <div class="user-section">
            <div class="user-info">
                <div class="user-avatar" id="user-avatar">U</div>
                <div class="user-details">
                    <div class="user-name" id="user-name">User Name</div>
                    <div class="user-role" id="user-role">Role • Department</div>
                </div>
            </div>
            <button class="logout-btn" id="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                Đăng xuất
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <h1 class="page-title" id="page-title">Calendar</h1>
            <div class="header-actions">
                <div class="calendar-selector">
                    <select id="calendar-select">
                        <option value="">Chọn đợt</option>
                    </select>
                    <button class="create-btn" id="create-calendar-btn">
                        <i class="fas fa-plus"></i>
                        Tạo đợt
                    </button>
                </div>
                <button class="refresh-btn" id="refresh-btn">
                    <i class="fas fa-sync-alt"></i>
                    Làm mới
                </button>
                <button class="export-btn" id="export-btn">
                    <i class="fas fa-download"></i>
                    Xuất file
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Calendar Content -->
            <div id="calendar-content">
                <!-- Filters -->
                <div class="filters">
                    <div class="filter-group">
                        <label class="filter-label">Ban</label>
                        <select class="filter-select" id="filter-department">
                            <option value="">Tất cả ban</option>
                            <option value="MD">Truyền thông (MD)</option>
                            <option value="HR">Nhân sự (HR)</option>
                            <option value="PD">Dự án (PD)</option>
                            <option value="ER">Đối ngoại (ER)</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Vòng</label>
                        <select class="filter-select" id="filter-round">
                            <option value="">Tất cả vòng</option>
                            <option value="round1">Vòng 1: Đơn</option>
                            <option value="round2">Vòng 2: Phỏng vấn nhóm</option>
                            <option value="round3">Vòng 3: Teamwork</option>
                            <option value="round4">Vòng 4: Phỏng vấn cá nhân</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Trạng thái</label>
                        <select class="filter-select" id="filter-status">
                            <option value="">Tất cả trạng thái</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="hidden">Hidden</option>
                        </select>
                    </div>
                </div>

                <!-- Calendar View -->
                <div class="calendar-view">
                    <!-- Calendar Week -->
                    <div class="calendar-week">
                        <div class="calendar-header">
                            <div class="calendar-nav">
                                <button id="prev-week"><i class="fas fa-chevron-left"></i></button>
                                <span id="current-week">Tuần 1-7 Tháng 1, 2023</span>
                                <button id="next-week"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <button class="create-btn" id="create-event-btn">
                                <i class="fas fa-plus"></i>
                                Tạo lịch
                            </button>
                        </div>
                        <div class="calendar-week-days">
                            <div class="calendar-week-day">Thứ 2</div>
                            <div class="calendar-week-day">Thứ 3</div>
                            <div class="calendar-week-day">Thứ 4</div>
                            <div class="calendar-week-day">Thứ 5</div>
                            <div class="calendar-week-day">Thứ 6</div>
                            <div class="calendar-week-day">Thứ 7</div>
                            <div class="calendar-week-day">Chủ nhật</div>
                        </div>
                        <div class="calendar-days" id="calendar-days">
                            <!-- Days will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Events List -->
                    <div class="events-list">
                        <div class="events-header">
                            <div class="events-title">Danh sách lịch</div>
                            <button class="add-event-btn" id="add-event-btn">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="events-container" id="events-container">
                            <!-- Events will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Keep Track Content -->
            <div id="keep-track-content" style="display: none;">
                <div class="keep-track-container">
                    <div class="keep-track-header">
                        <div class="keep-track-title">Theo dõi quá trình phỏng vấn</div>
                    </div>
                    <table class="keep-track-table">
                        <thead>
                            <tr>
                                <th>Họ và tên</th>
                                <th>Ban</th>
                                <th>Email</th>
                                <th>Số điện thoại</th>
                                <th>Quá trình phỏng vấn</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="keep-track-body">
                            <!-- Keep track data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Create Calendar Modal -->
    <div class="modal" id="create-calendar-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Tạo đợt mới</h2>
                <button class="modal-close" id="close-create-calendar-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Tên đợt</label>
                    <input type="text" class="form-input" id="calendar-name" placeholder="Nhập tên đợt">
                </div>
                <div class="form-group">
                    <label class="form-label">Mô tả</label>
                    <textarea class="form-textarea" id="calendar-description" placeholder="Nhập mô tả đợt"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Các ban được truy cập</label>
                    <div class="form-checkbox">
                        <input type="checkbox" id="department-md" value="MD">
                        <label for="department-md">Truyền thông (MD)</label>
                    </div>
                    <div class="form-checkbox">
                        <input type="checkbox" id="department-hr" value="HR">
                        <label for="department-hr">Nhân sự (HR)</label>
                    </div>
                    <div class="form-checkbox">
                        <input type="checkbox" id="department-pd" value="PD">
                        <label for="department-pd">Dự án (PD)</label>
                    </div>
                    <div class="form-checkbox">
                        <input type="checkbox" id="department-er" value="ER">
                        <label for="department-er">Đối ngoại (ER)</label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="form-checkbox">
                        <input type="checkbox" id="calendar-keep-track">
                        <label for="calendar-keep-track">Bật theo dõi quá trình phỏng vấn</label>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancel-create-calendar">Hủy</button>
                    <button class="btn btn-primary" id="save-calendar">Lưu</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Event Modal -->
    <div class="modal" id="create-event-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Tạo lịch mới</h2>
                <button class="modal-close" id="close-create-event-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-tabs">
                    <div class="modal-tab active" data-tab="config">Cấu hình</div>
                    <div class="modal-tab" data-tab="slots">Các ca</div>
                </div>
                
                <!-- Tab 1: Configuration -->
                <div id="config-tab" class="tab-content">
                    <div class="form-group">
                        <label class="form-label">Đợt</label>
                        <select class="form-select" id="event-calendar">
                            <option value="">Chọn đợt</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tên lịch</label>
                        <input type="text" class="form-input" id="event-title" placeholder="Nhập tên lịch">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ban</label>
                        <select class="form-select" id="event-department">
                            <option value="">Chọn ban</option>
                            <option value="MD">Truyền thông (MD)</option>
                            <option value="HR">Nhân sự (HR)</option>
                            <option value="PD">Dự án (PD)</option>
                            <option value="ER">Đối ngoại (ER)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Vòng</label>
                        <select class="form-select" id="event-round">
                            <option value="">Chọn vòng</option>
                            <option value="round1">Vòng 1: Đơn</option>
                            <option value="round2">Vòng 2: Phỏng vấn nhóm</option>
                            <option value="round3">Vòng 3: Teamwork</option>
                            <option value="round4">Vòng 4: Phỏng vấn cá nhân</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hình thức</label>
                        <select class="form-select" id="event-format">
                            <option value="online">Online</option>
                            <option value="offline">Offline</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Thời gian</label>
                        <div style="display: flex; gap: 12px;">
                            <input type="datetime-local" class="form-input" id="event-start-time">
                            <input type="datetime-local" class="form-input" id="event-end-time">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-checkbox">
                            <input type="checkbox" id="event-allow-multiple">
                            <label for="event-allow-multiple">Cho phép ứng viên chọn nhiều ca</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-checkbox">
                            <input type="checkbox" id="event-allow-edit">
                            <label for="event-allow-edit">Cho phép sửa vote</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ghi chú</label>
                        <textarea class="form-textarea" id="event-note" placeholder="Nhập ghi chú (không bắt buộc)"></textarea>
                    </div>
                </div>
                
                <!-- Tab 2: Slots -->
                <div id="slots-tab" class="tab-content" style="display: none;">
                    <div id="slots-container">
                        <!-- Slots will be added here -->
                    </div>
                    <button class="add-slot-btn" id="add-slot-btn">
                        <i class="fas fa-plus"></i>
                        Thêm ca
                    </button>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancel-create-event">Hủy</button>
                    <button class="btn btn-primary" id="save-event">Lưu</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Detail Modal -->
    <div class="modal" id="event-detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="event-detail-title">Chi tiết lịch</h2>
                <button class="modal-close" id="close-event-detail-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="event-detail-tabs">
                    <div class="event-detail-tab active" data-tab="info">Thông tin</div>
                    <div class="event-detail-tab" data-tab="candidates">Ứng viên</div>
                </div>
                
                <!-- Tab 1: Info -->
                <div id="info-tab" class="tab-content">
                    <div class="event-info-grid">
                        <div class="event-info-item">
                            <div class="event-info-label">Đợt</div>
                            <div class="event-info-value" id="detail-calendar">Đợt 1</div>
                        </div>
                        <div class="event-info-item">
                            <div class="event-info-label">Ban</div>
                            <div class="event-info-value" id="detail-department">Truyền thông (MD)</div>
                        </div>
                        <div class="event-info-item">
                            <div class="event-info-label">Vòng</div>
                            <div class="event-info-value" id="detail-round">Vòng 2: Phỏng vấn nhóm</div>
                        </div>
                        <div class="event-info-item">
                            <div class="event-info-label">Slot</div>
                            <div class="event-info-value" id="detail-slots">5/10 người vote</div>
                        </div>
                        <div class="event-info-item">
                            <div class="event-info-label">Hình thức</div>
                            <div class="event-info-value" id="detail-format">Online</div>
                        </div>
                        <div class="event-info-item">
                            <div class="event-info-label">Thời gian</div>
                            <div class="event-info-value" id="detail-time">10:00 - 12:00, 15/10/2023</div>
                        </div>
                    </div>
                    
                    <div class="slots-container">
                        <h3 style="margin-bottom: 12px;">Các ca</h3>
                        <div id="detail-slots-container">
                            <!-- Slots will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <!-- Tab 2: Candidates -->
                <div id="candidates-tab" class="tab-content" style="display: none;">
                    <div class="candidates-container">
                        <div id="detail-candidates-container">
                            <!-- Candidates will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="hide-event-btn">Ẩn lịch</button>
                    <button class="btn btn-secondary" id="lock-event-btn">Khóa lịch</button>
                    <button class="btn btn-primary" id="edit-event-btn">Chỉnh sửa</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Candidate Detail Modal -->
    <div class="modal" id="candidate-detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Chi tiết ứng viên</h2>
                <button class="modal-close" id="close-candidate-detail-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Họ và tên</label>
                    <div id="candidate-fullname">Nguyễn Văn A</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <div id="candidate-email">nguyenvana@example.com</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Ban</label>
                    <div id="candidate-department">Truyền thông (MD)</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Trạng thái</label>
                    <select class="form-select" id="candidate-status">
                        <option value="pending">Pending</option>
                        <option value="voted">Voted</option>
                        <option value="delayed">Delayed</option>
                        <option value="checkin">Checkin</option>
                        <option value="interviewed">Interviewed</option>
                        <option value="selected">Selected</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Ca đã vote</label>
                    <div id="candidate-voted-slots">
                        <!-- Voted slots will be populated by JavaScript -->
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Chọn ca cho ứng viên</label>
                    <select class="form-select" id="candidate-selected-slot">
                        <option value="">Chọn ca</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancel-candidate-detail">Hủy</button>
                    <button class="btn btn-primary" id="save-candidate-detail">Lưu</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Cài đặt đợt</h2>
                <button class="modal-close" id="close-settings-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Tên đợt</label>
                    <input type="text" class="form-input" id="settings-calendar-name" placeholder="Nhập tên đợt">
                </div>
                <div class="form-group">
                    <label class="form-label">Các ban được truy cập</label>
                    <div class="form-checkbox">
                        <input type="checkbox" id="settings-department-md" value="MD">
                        <label for="settings-department-md">Truyền thông (MD)</label>
                    </div>
                    <div class="form-checkbox">
                        <input type="checkbox" id="settings-department-hr" value="HR">
                        <label for="settings-department-hr">Nhân sự (HR)</label>
                    </div>
                    <div class="form-checkbox">
                        <input type="checkbox" id="settings-department-pd" value="PD">
                        <label for="settings-department-pd">Dự án (PD)</label>
                    </div>
                    <div class="form-checkbox">
                        <input type="checkbox" id="settings-department-er" value="ER">
                        <label for="settings-department-er">Đối ngoại (ER)</label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="form-checkbox">
                        <input type="checkbox" id="settings-locked">
                        <label for="settings-locked">Khóa đợt</label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="form-checkbox">
                        <input type="checkbox" id="settings-hidden">
                        <label for="settings-hidden">Ẩn đợt</label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="form-checkbox">
                        <input type="checkbox" id="settings-keep-track">
                        <label for="settings-keep-track">Bật theo dõi quá trình phỏng vấn</label>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancel-settings">Hủy</button>
                    <button class="btn btn-primary" id="save-settings">Lưu</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="export-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Xuất dữ liệu</h2>
                <button class="modal-close" id="close-export-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Loại xuất</label>
                    <select class="form-select" id="export-type">
                        <option value="calendar">Theo đợt</option>
                        <option value="department">Theo ban</option>
                        <option value="event">Theo lịch</option>
                        <option value="date">Theo ngày</option>
                    </select>
                </div>
                <div class="form-group" id="export-calendar-group">
                    <label class="form-label">Đợt</label>
                    <select class="form-select" id="export-calendar">
                        <option value="">Chọn đợt</option>
                    </select>
                </div>
                <div class="form-group" id="export-department-group" style="display: none;">
                    <label class="form-label">Ban</label>
                    <select class="form-select" id="export-department">
                        <option value="">Chọn ban</option>
                        <option value="MD">Truyền thông (MD)</option>
                        <option value="HR">Nhân sự (HR)</option>
                        <option value="PD">Dự án (PD)</option>
                        <option value="ER">Đối ngoại (ER)</option>
                    </select>
                </div>
                <div class="form-group" id="export-event-group" style="display: none;">
                    <label class="form-label">Lịch</label>
                    <select class="form-select" id="export-event">
                        <option value="">Chọn lịch</option>
                    </select>
                </div>
                <div class="form-group" id="export-date-group" style="display: none;">
                    <label class="form-label">Ngày</label>
                    <input type="date" class="form-input" id="export-date">
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancel-export">Hủy</button>
                    <button class="btn btn-primary" id="confirm-export">Xuất</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAOP2j0qV0Ge-q2-Y9zo9Qc3eLmgtVOK3k",
            authDomain: "recruitment-enactusftuhanoi.firebaseapp.com",
            projectId: "recruitment-enactusftuhanoi",
            storageBucket: "recruitment-enactusftuhanoi.firebasestorage.app",
            messagingSenderId: "658928769643",
            appId: "1:658928769643:web:ef4e26633b7c41c922ef2e",
            measurementId: "G-BJT7ZPKYE3"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global variables
        let currentUser = null;
        let currentCalendar = null;
        let calendars = [];
        let events = [];
        let currentWeekStart = new Date();
        let currentEvent = null;
        let currentCandidate = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Check authentication state
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    loadUserData();
                    loadCalendars();
                    setupEventListeners();
                } else {
                    // Redirect to login if not authenticated
                    window.location.href = 'login.html';
                }
            });
        }

        function loadUserData() {
            // Load user data from Firestore
            db.collection('users').doc(currentUser.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        document.getElementById('user-name').textContent = userData.name || 'User Name';
                        document.getElementById('user-role').textContent = `${userData.role} • ${userData.department}`;
                        document.getElementById('user-avatar').textContent = userData.name ? userData.name.charAt(0).toUpperCase() : 'U';
                        
                        // Show/hide menu items based on role
                        if (userData.role === 'superadmin') {
                            document.querySelectorAll('.system-settings-menu').forEach(el => {
                                el.style.display = 'flex';
                            });
                        }
                    }
                })
                .catch(error => {
                    console.error('Error loading user data:', error);
                });
        }

        function loadCalendars() {
            // Load calendars from Firestore
            db.collection('calendars').get()
                .then(querySnapshot => {
                    calendars = [];
                    const calendarSelect = document.getElementById('calendar-select');
                    calendarSelect.innerHTML = '<option value="">Chọn đợt</option>';
                    
                    querySnapshot.forEach(doc => {
                        const calendar = { id: doc.id, ...doc.data() };
                        calendars.push(calendar);
                        
                        const option = document.createElement('option');
                        option.value = calendar.id;
                        option.textContent = calendar.name;
                        calendarSelect.appendChild(option);
                    });
                    
                    // Also populate calendar selects in modals
                    populateCalendarSelects();
                })
                .catch(error => {
                    console.error('Error loading calendars:', error);
                });
        }

        function populateCalendarSelects() {
            const calendarSelects = [
                document.getElementById('event-calendar'),
                document.getElementById('export-calendar')
            ];
            
            calendarSelects.forEach(select => {
                if (select) {
                    select.innerHTML = '<option value="">Chọn đợt</option>';
                    calendars.forEach(calendar => {
                        const option = document.createElement('option');
                        option.value = calendar.id;
                        option.textContent = calendar.name;
                        select.appendChild(option);
                    });
                }
            });
        }

        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-item[data-tab]').forEach(item => {
                item.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    switchTab(tab);
                });
            });

            // Calendar selector
            document.getElementById('calendar-select').addEventListener('change', function() {
                currentCalendar = this.value;
                loadEvents();
                updateCalendarView();
            });

            // Create calendar button
            document.getElementById('create-calendar-btn').addEventListener('click', function() {
                showModal('create-calendar-modal');
            });

            // Create event button
            document.getElementById('create-event-btn').addEventListener('click', function() {
                showModal('create-event-modal');
            });

            // Add event button in events list
            document.getElementById('add-event-btn').addEventListener('click', function() {
                showModal('create-event-modal');
            });

            // Refresh button
            document.getElementById('refresh-btn').addEventListener('click', function() {
                loadCalendars();
                loadEvents();
            });

            // Export button
            document.getElementById('export-btn').addEventListener('click', function() {
                showModal('export-modal');
            });

            // Logout button
            document.getElementById('logout-btn').addEventListener('click', function() {
                auth.signOut().then(() => {
                    window.location.href = 'login.html';
                });
            });

            // Week navigation
            document.getElementById('prev-week').addEventListener('click', function() {
                currentWeekStart.setDate(currentWeekStart.getDate() - 7);
                updateCalendarView();
            });

            document.getElementById('next-week').addEventListener('click', function() {
                currentWeekStart.setDate(currentWeekStart.getDate() + 7);
                updateCalendarView();
            });

            // Modal close buttons
            document.getElementById('close-create-calendar-modal').addEventListener('click', function() {
                hideModal('create-calendar-modal');
            });

            document.getElementById('close-create-event-modal').addEventListener('click', function() {
                hideModal('create-event-modal');
            });

            document.getElementById('close-event-detail-modal').addEventListener('click', function() {
                hideModal('event-detail-modal');
            });

            document.getElementById('close-candidate-detail-modal').addEventListener('click', function() {
                hideModal('candidate-detail-modal');
            });

            document.getElementById('close-settings-modal').addEventListener('click', function() {
                hideModal('settings-modal');
            });

            document.getElementById('close-export-modal').addEventListener('click', function() {
                hideModal('export-modal');
            });

            // Cancel buttons
            document.getElementById('cancel-create-calendar').addEventListener('click', function() {
                hideModal('create-calendar-modal');
            });

            document.getElementById('cancel-create-event').addEventListener('click', function() {
                hideModal('create-event-modal');
            });

            document.getElementById('cancel-candidate-detail').addEventListener('click', function() {
                hideModal('candidate-detail-modal');
            });

            document.getElementById('cancel-settings').addEventListener('click', function() {
                hideModal('settings-modal');
            });

            document.getElementById('cancel-export').addEventListener('click', function() {
                hideModal('export-modal');
            });

            // Save buttons
            document.getElementById('save-calendar').addEventListener('click', saveCalendar);
            document.getElementById('save-event').addEventListener('click', saveEvent);
            document.getElementById('save-candidate-detail').addEventListener('click', saveCandidateDetail);
            document.getElementById('save-settings').addEventListener('click', saveSettings);
            document.getElementById('confirm-export').addEventListener('click', exportData);

            // Modal tabs
            document.querySelectorAll('.modal-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchModalTab(tabName);
                });
            });

            // Event detail tabs
            document.querySelectorAll('.event-detail-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchEventDetailTab(tabName);
                });
            });

            // Add slot button
            document.getElementById('add-slot-btn').addEventListener('click', addSlot);

            // Export type change
            document.getElementById('export-type').addEventListener('change', function() {
                updateExportForm();
            });

            // Initialize calendar view
            updateCalendarView();
        }

        function switchTab(tab) {
            // Hide all content
            document.getElementById('calendar-content').style.display = 'none';
            document.getElementById('keep-track-content').style.display = 'none';
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected content and set active nav item
            if (tab === 'calendar') {
                document.getElementById('calendar-content').style.display = 'block';
                document.querySelector('.nav-item[data-tab="calendar"]').classList.add('active');
                document.getElementById('page-title').textContent = 'Calendar';
            } else if (tab === 'keep-track') {
                document.getElementById('keep-track-content').style.display = 'block';
                document.querySelector('.nav-item[data-tab="keep-track"]').classList.add('active');
                document.getElementById('page-title').textContent = 'Keep Track';
                loadKeepTrackData();
            }
        }

        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function switchModalTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('#create-event-modal .tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('#create-event-modal .modal-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab and set active class
            document.getElementById(`${tabName}-tab`).style.display = 'block';
            document.querySelector(`#create-event-modal .modal-tab[data-tab="${tabName}"]`).classList.add('active');
        }

        function switchEventDetailTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('#event-detail-modal .tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('#event-detail-modal .event-detail-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab and set active class
            document.getElementById(`${tabName}-tab`).style.display = 'block';
            document.querySelector(`#event-detail-modal .event-detail-tab[data-tab="${tabName}"]`).classList.add('active');
        }

        function updateCalendarView() {
            const calendarDays = document.getElementById('calendar-days');
            calendarDays.innerHTML = '';
            
            // Calculate the week dates
            const weekStart = new Date(currentWeekStart);
            weekStart.setDate(weekStart.getDate() - weekStart.getDay() + 1); // Start from Monday
            
            // Update week display
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            const options = { day: 'numeric', month: 'numeric', year: 'numeric' };
            document.getElementById('current-week').textContent = 
                `Tuần ${weekStart.getDate()}-${weekEnd.getDate()} Tháng ${weekStart.getMonth() + 1}, ${weekStart.getFullYear()}`;
            
            // Create day elements
            for (let i = 0; i < 7; i++) {
                const day = new Date(weekStart);
                day.setDate(day.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day.getDate();
                
                dayHeader.appendChild(dayNumber);
                dayElement.appendChild(dayHeader);
                
                const dayEvents = document.createElement('div');
                dayEvents.className = 'day-events';
                
                // Filter events for this day
                const dayEventsList = events.filter(event => {
                    const eventDate = event.start_time.toDate();
                    return eventDate.getDate() === day.getDate() && 
                           eventDate.getMonth() === day.getMonth() && 
                           eventDate.getFullYear() === day.getFullYear();
                });
                
                // Add events to the day
                dayEventsList.forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.className = 'day-event';
                    eventElement.textContent = `${event.title} | ${getDepartmentName(event.department)}`;
                    eventElement.addEventListener('click', function() {
                        showEventDetail(event);
                    });
                    dayEvents.appendChild(eventElement);
                });
                
                dayElement.appendChild(dayEvents);
                calendarDays.appendChild(dayElement);
            }
        }

        function loadEvents() {
            if (!currentCalendar) return;
            
            // Load events from Firestore
            db.collection('calendar_events')
                .where('calendar_id', '==', currentCalendar)
                .get()
                .then(querySnapshot => {
                    events = [];
                    querySnapshot.forEach(doc => {
                        events.push({ id: doc.id, ...doc.data() });
                    });
                    
                    updateEventsList();
                    updateCalendarView();
                })
                .catch(error => {
                    console.error('Error loading events:', error);
                });
        }

        function updateEventsList() {
            const eventsContainer = document.getElementById('events-container');
            eventsContainer.innerHTML = '';
            
            events.forEach(event => {
                const eventElement = document.createElement('div');
                eventElement.className = 'event-item';
                eventElement.addEventListener('click', function() {
                    showEventDetail(event);
                });
                
                const eventHeader = document.createElement('div');
                eventHeader.className = 'event-item-header';
                
                const eventTitle = document.createElement('div');
                eventTitle.className = 'event-title';
                eventTitle.textContent = event.title;
                
                const eventDepartment = document.createElement('div');
                eventDepartment.className = 'event-department';
                eventDepartment.textContent = getDepartmentName(event.department);
                
                const eventStatus = document.createElement('div');
                eventStatus.className = `event-status ${getEventStatusClass(event)}`;
                eventStatus.textContent = getEventStatusText(event);
                
                eventHeader.appendChild(eventTitle);
                eventHeader.appendChild(eventDepartment);
                eventHeader.appendChild(eventStatus);
                
                const eventDetails = document.createElement('div');
                eventDetails.className = 'event-details';
                eventDetails.textContent = `${getRoundName(event.round)} • ${formatDate(event.start_time.toDate())}`;
                
                const eventSlots = document.createElement('div');
                eventSlots.className = 'event-slots';
                eventSlots.textContent = `Slots: ${event.slots ? event.slots.length : 0}`;
                
                eventElement.appendChild(eventHeader);
                eventElement.appendChild(eventDetails);
                eventElement.appendChild(eventSlots);
                
                eventsContainer.appendChild(eventElement);
            });
        }

        function getDepartmentName(code) {
            const departments = {
                'MD': 'Truyền thông',
                'HR': 'Nhân sự',
                'PD': 'Dự án',
                'ER': 'Đối ngoại'
            };
            return departments[code] || code;
        }

        function getRoundName(round) {
            const rounds = {
                'round1': 'Vòng 1: Đơn',
                'round2': 'Vòng 2: Phỏng vấn nhóm',
                'round3': 'Vòng 3: Teamwork',
                'round4': 'Vòng 4: Phỏng vấn cá nhân'
            };
            return rounds[round] || round;
        }

        function getEventStatusClass(event) {
            if (event.is_hidden) return 'status-hidden';
            if (event.is_locked) return 'status-completed';
            return 'status-active';
        }

        function getEventStatusText(event) {
            if (event.is_hidden) return 'Hidden';
            if (event.is_locked) return 'Completed';
            return 'Active';
        }

        function formatDate(date) {
            return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
        }

        function addSlot() {
            const slotsContainer = document.getElementById('slots-container');
            const slotCount = slotsContainer.children.length + 1;
            
            const slotElement = document.createElement('div');
            slotElement.className = 'slot-item';
            
            slotElement.innerHTML = `
                <div>
                    <label class="form-label">Ngày</label>
                    <input type="date" class="form-input slot-date" value="${getFormattedDateForInput(new Date())}">
                </div>
                <div>
                    <label class="form-label">Giờ bắt đầu</label>
                    <input type="time" class="form-input slot-start-time" value="09:00">
                </div>
                <div>
                    <label class="form-label">Giờ kết thúc</label>
                    <input type="time" class="form-input slot-end-time" value="10:00">
                </div>
                <button class="remove-slot" type="button">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Add event listener to remove button
            slotElement.querySelector('.remove-slot').addEventListener('click', function() {
                slotElement.remove();
            });
            
            slotsContainer.appendChild(slotElement);
        }

        function getFormattedDateForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function showEventDetail(event) {
            currentEvent = event;
            
            // Set event details
            document.getElementById('event-detail-title').textContent = event.title;
            document.getElementById('detail-calendar').textContent = getCalendarName(event.calendar_id);
            document.getElementById('detail-department').textContent = getDepartmentName(event.department);
            document.getElementById('detail-round').textContent = getRoundName(event.round);
            document.getElementById('detail-format').textContent = event.format === 'online' ? 'Online' : 'Offline';
            document.getElementById('detail-time').textContent = 
                `${formatDateTime(event.start_time.toDate())} - ${formatTime(event.end_time.toDate())}`;
            
            // Calculate slots info
            const totalSlots = event.slots ? event.slots.length : 0;
            const votedSlots = event.slots ? event.slots.filter(slot => slot.votes && slot.votes.length > 0).length : 0;
            document.getElementById('detail-slots').textContent = `${votedSlots}/${totalSlots} người vote`;
            
            // Populate slots
            const slotsContainer = document.getElementById('detail-slots-container');
            slotsContainer.innerHTML = '';
            
            if (event.slots && event.slots.length > 0) {
                event.slots.forEach(slot => {
                    const slotElement = document.createElement('div');
                    slotElement.className = 'slot-card';
                    
                    const slotHeader = document.createElement('div');
                    slotHeader.className = 'slot-header';
                    
                    const slotTitle = document.createElement('div');
                    slotTitle.className = 'slot-title';
                    slotTitle.textContent = `Ca ${slot.slot_number}: ${slot.date} ${slot.start_time} - ${slot.end_time}`;
                    
                    const slotVotes = document.createElement('div');
                    slotVotes.className = 'slot-votes';
                    slotVotes.textContent = `${slot.votes ? slot.votes.length : 0} người vote`;
                    
                    slotHeader.appendChild(slotTitle);
                    slotHeader.appendChild(slotVotes);
                    
                    const slotCandidates = document.createElement('div');
                    slotCandidates.className = 'slot-candidates';
                    
                    if (slot.votes && slot.votes.length > 0) {
                        slot.votes.forEach(vote => {
                            const candidateBadge = document.createElement('div');
                            candidateBadge.className = 'candidate-badge';
                            candidateBadge.textContent = vote.fullname || 'Ứng viên';
                            slotCandidates.appendChild(candidateBadge);
                        });
                    } else {
                        slotCandidates.textContent = 'Chưa có người vote';
                    }
                    
                    slotElement.appendChild(slotHeader);
                    slotElement.appendChild(slotCandidates);
                    
                    slotsContainer.appendChild(slotElement);
                });
            } else {
                slotsContainer.textContent = 'Chưa có ca nào được tạo';
            }
            
            // Load candidates for this event
            loadEventCandidates(event.id);
            
            // Show modal
            showModal('event-detail-modal');
        }

        function getCalendarName(calendarId) {
            const calendar = calendars.find(c => c.id === calendarId);
            return calendar ? calendar.name : 'Unknown Calendar';
        }

        function formatDateTime(date) {
            return `${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}, ${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
        }

        function formatTime(date) {
            return `${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
        }

        function loadEventCandidates(eventId) {
            // Load candidates for this event from Firestore
            db.collection('calendar_candidates')
                .where('event_id', '==', eventId)
                .get()
                .then(querySnapshot => {
                    const candidatesContainer = document.getElementById('detail-candidates-container');
                    candidatesContainer.innerHTML = '';
                    
                    querySnapshot.forEach(doc => {
                        const candidate = { id: doc.id, ...doc.data() };
                        const candidateElement = createCandidateElement(candidate);
                        candidatesContainer.appendChild(candidateElement);
                    });
                })
                .catch(error => {
                    console.error('Error loading candidates:', error);
                });
        }

        function createCandidateElement(candidate) {
            const candidateElement = document.createElement('div');
            candidateElement.className = 'candidate-item';
            
            const candidateInfo = document.createElement('div');
            candidateInfo.className = 'candidate-info';
            
            const candidateName = document.createElement('div');
            candidateName.className = 'candidate-name';
            candidateName.textContent = candidate.fullname;
            
            const candidateEmail = document.createElement('div');
            candidateEmail.className = 'candidate-email';
            candidateEmail.textContent = candidate.email;
            
            candidateInfo.appendChild(candidateName);
            candidateInfo.appendChild(candidateEmail);
            
            const candidateStatus = document.createElement('div');
            candidateStatus.className = `candidate-status status-${candidate.status}`;
            candidateStatus.textContent = getCandidateStatusText(candidate.status);
            
            const candidateActions = document.createElement('div');
            candidateActions.className = 'candidate-actions';
            
            const detailsButton = document.createElement('button');
            detailsButton.className = 'btn btn-secondary';
            detailsButton.textContent = 'Chi tiết';
            detailsButton.addEventListener('click', function() {
                showCandidateDetail(candidate);
            });
            
            candidateActions.appendChild(detailsButton);
            
            candidateElement.appendChild(candidateInfo);
            candidateElement.appendChild(candidateStatus);
            candidateElement.appendChild(candidateActions);
            
            return candidateElement;
        }

        function getCandidateStatusText(status) {
            const statusTexts = {
                'pending': 'Pending',
                'voted': 'Voted',
                'delayed': 'Delayed',
                'checkin': 'Checkin',
                'interviewed': 'Interviewed',
                'selected': 'Selected'
            };
            return statusTexts[status] || status;
        }

        function showCandidateDetail(candidate) {
            currentCandidate = candidate;
            
            // Set candidate details
            document.getElementById('candidate-fullname').textContent = candidate.fullname;
            document.getElementById('candidate-email').textContent = candidate.email;
            document.getElementById('candidate-department').textContent = getDepartmentName(candidate.department);
            document.getElementById('candidate-status').value = candidate.status;
            
            // Populate voted slots
            const votedSlotsContainer = document.getElementById('candidate-voted-slots');
            votedSlotsContainer.innerHTML = '';
            
            if (candidate.voted_slots && candidate.voted_slots.length > 0) {
                candidate.voted_slots.forEach(slotId => {
                    // In a real implementation, you would fetch slot details from Firestore
                    const slotElement = document.createElement('div');
                    slotElement.textContent = `Ca ${slotId}`;
                    votedSlotsContainer.appendChild(slotElement);
                });
            } else {
                votedSlotsContainer.textContent = 'Chưa vote ca nào';
            }
            
            // Populate selected slot dropdown
            const selectedSlotSelect = document.getElementById('candidate-selected-slot');
            selectedSlotSelect.innerHTML = '<option value="">Chọn ca</option>';
            
            if (currentEvent && currentEvent.slots) {
                currentEvent.slots.forEach(slot => {
                    const option = document.createElement('option');
                    option.value = slot.id;
                    option.textContent = `Ca ${slot.slot_number}: ${slot.date} ${slot.start_time} - ${slot.end_time}`;
                    if (candidate.selected_slot === slot.id) {
                        option.selected = true;
                    }
                    selectedSlotSelect.appendChild(option);
                });
            }
            
            // Show modal
            showModal('candidate-detail-modal');
        }

        function saveCalendar() {
            const name = document.getElementById('calendar-name').value;
            const description = document.getElementById('calendar-description').value;
            
            // Get selected departments
            const departments = [];
            if (document.getElementById('department-md').checked) departments.push('MD');
            if (document.getElementById('department-hr').checked) departments.push('HR');
            if (document.getElementById('department-pd').checked) departments.push('PD');
            if (document.getElementById('department-er').checked) departments.push('ER');
            
            const keepTrack = document.getElementById('calendar-keep-track').checked;
            
            if (!name) {
                alert('Vui lòng nhập tên đợt');
                return;
            }
            
            if (departments.length === 0) {
                alert('Vui lòng chọn ít nhất một ban');
                return;
            }
            
            // Save to Firestore
            db.collection('calendars').add({
                name: name,
                description: description,
                accessible_departments: departments,
                is_locked: false,
                is_hidden: false,
                keep_track: keepTrack,
                created_by: currentUser.uid,
                created_at: firebase.firestore.FieldValue.serverTimestamp(),
                updated_at: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                alert('Đã tạo đợt mới thành công');
                hideModal('create-calendar-modal');
                loadCalendars();
                
                // Reset form
                document.getElementById('calendar-name').value = '';
                document.getElementById('calendar-description').value = '';
                document.getElementById('department-md').checked = false;
                document.getElementById('department-hr').checked = false;
                document.getElementById('department-pd').checked = false;
                document.getElementById('department-er').checked = false;
                document.getElementById('calendar-keep-track').checked = false;
            })
            .catch(error => {
                console.error('Error creating calendar:', error);
                alert('Có lỗi xảy ra khi tạo đợt');
            });
        }

        function saveEvent() {
            const calendarId = document.getElementById('event-calendar').value;
            const title = document.getElementById('event-title').value;
            const department = document.getElementById('event-department').value;
            const round = document.getElementById('event-round').value;
            const format = document.getElementById('event-format').value;
            const startTime = document.getElementById('event-start-time').value;
            const endTime = document.getElementById('event-end-time').value;
            const allowMultiple = document.getElementById('event-allow-multiple').checked;
            const allowEdit = document.getElementById('event-allow-edit').checked;
            const note = document.getElementById('event-note').value;
            
            // Get slots
            const slots = [];
            const slotElements = document.querySelectorAll('.slot-item');
            slotElements.forEach((element, index) => {
                const date = element.querySelector('.slot-date').value;
                const startTime = element.querySelector('.slot-start-time').value;
                const endTime = element.querySelector('.slot-end-time').value;
                
                if (date && startTime && endTime) {
                    slots.push({
                        slot_number: index + 1,
                        date: formatDateForDisplay(date),
                        start_time: startTime,
                        end_time: endTime,
                        votes: [],
                        selected_candidates: []
                    });
                }
            });
            
            if (!calendarId || !title || !department || !round || !startTime || !endTime) {
                alert('Vui lòng điền đầy đủ thông tin bắt buộc');
                return;
            }
            
            if (slots.length === 0) {
                alert('Vui lòng thêm ít nhất một ca');
                return;
            }
            
            // Convert datetime strings to Firestore timestamps
            const startTimestamp = firebase.firestore.Timestamp.fromDate(new Date(startTime));
            const endTimestamp = firebase.firestore.Timestamp.fromDate(new Date(endTime));
            
            // Save to Firestore
            db.collection('calendar_events').add({
                calendar_id: calendarId,
                title: title,
                department: department,
                round: round,
                format: format,
                start_time: startTimestamp,
                end_time: endTimestamp,
                allow_multiple_slots: allowMultiple,
                allow_edit_vote: allowEdit,
                note: note,
                is_hidden: false,
                is_locked: false,
                slots: slots,
                candidates: [],
                created_by: currentUser.uid,
                created_at: firebase.firestore.FieldValue.serverTimestamp(),
                updated_at: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                alert('Đã tạo lịch mới thành công');
                hideModal('create-event-modal');
                loadEvents();
                
                // Reset form
                document.getElementById('event-title').value = '';
                document.getElementById('event-department').value = '';
                document.getElementById('event-round').value = '';
                document.getElementById('event-format').value = 'online';
                document.getElementById('event-start-time').value = '';
                document.getElementById('event-end-time').value = '';
                document.getElementById('event-allow-multiple').checked = false;
                document.getElementById('event-allow-edit').checked = false;
                document.getElementById('event-note').value = '';
                document.getElementById('slots-container').innerHTML = '';
            })
            .catch(error => {
                console.error('Error creating event:', error);
                alert('Có lỗi xảy ra khi tạo lịch');
            });
        }

        function formatDateForDisplay(dateString) {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function saveCandidateDetail() {
            if (!currentCandidate) return;
            
            const status = document.getElementById('candidate-status').value;
            const selectedSlot = document.getElementById('candidate-selected-slot').value;
            
            // Update in Firestore
            db.collection('calendar_candidates').doc(currentCandidate.id).update({
                status: status,
                selected_slot: selectedSlot,
                updated_at: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                alert('Đã cập nhật thông tin ứng viên');
                hideModal('candidate-detail-modal');
                
                // Reload event detail to reflect changes
                if (currentEvent) {
                    loadEventCandidates(currentEvent.id);
                }
            })
            .catch(error => {
                console.error('Error updating candidate:', error);
                alert('Có lỗi xảy ra khi cập nhật ứng viên');
            });
        }

        function saveSettings() {
            // This would save calendar settings
            // Implementation depends on which calendar is being edited
            alert('Đã lưu cài đặt');
            hideModal('settings-modal');
        }

        function updateExportForm() {
            const exportType = document.getElementById('export-type').value;
            
            // Hide all export option groups
            document.getElementById('export-calendar-group').style.display = 'none';
            document.getElementById('export-department-group').style.display = 'none';
            document.getElementById('export-event-group').style.display = 'none';
            document.getElementById('export-date-group').style.display = 'none';
            
            // Show the relevant group
            if (exportType === 'calendar') {
                document.getElementById('export-calendar-group').style.display = 'block';
            } else if (exportType === 'department') {
                document.getElementById('export-department-group').style.display = 'block';
            } else if (exportType === 'event') {
                document.getElementById('export-event-group').style.display = 'block';
            } else if (exportType === 'date') {
                document.getElementById('export-date-group').style.display = 'block';
            }
        }

        function exportData() {
            const exportType = document.getElementById('export-type').value;
            let exportData = {};
            
            if (exportType === 'calendar') {
                const calendarId = document.getElementById('export-calendar').value;
                if (!calendarId) {
                    alert('Vui lòng chọn đợt');
                    return;
                }
                exportData.calendarId = calendarId;
            } else if (exportType === 'department') {
                const department = document.getElementById('export-department').value;
                if (!department) {
                    alert('Vui lòng chọn ban');
                    return;
                }
                exportData.department = department;
            } else if (exportType === 'event') {
                const eventId = document.getElementById('export-event').value;
                if (!eventId) {
                    alert('Vui lòng chọn lịch');
                    return;
                }
                exportData.eventId = eventId;
            } else if (exportType === 'date') {
                const date = document.getElementById('export-date').value;
                if (!date) {
                    alert('Vui lòng chọn ngày');
                    return;
                }
                exportData.date = date;
            }
            
            // In a real implementation, you would generate and download the export file
            alert(`Đã xuất dữ liệu theo ${exportType}`);
            hideModal('export-modal');
        }

        function loadKeepTrackData() {
            // Load keep track data from Firestore
            // This would load candidates with their interview progress
            const keepTrackBody = document.getElementById('keep-track-body');
            keepTrackBody.innerHTML = '';
            
            // Example data - in a real implementation, this would come from Firestore
            const exampleData = [
                {
                    fullname: 'Nguyễn Văn A',
                    department: 'MD',
                    email: 'nguyenvana@example.com',
                    phone: '0123456789',
                    progress: 'selected'
                },
                {
                    fullname: 'Trần Thị B',
                    department: 'HR',
                    email: 'tranthib@example.com',
                    phone: '0987654321',
                    progress: 'checkin'
                },
                {
                    fullname: 'Lê Văn C',
                    department: 'PD',
                    email: 'levanc@example.com',
                    phone: '0369852147',
                    progress: 'interviewing'
                },
                {
                    fullname: 'Phạm Thị D',
                    department: 'ER',
                    email: 'phamthid@example.com',
                    phone: '0547896321',
                    progress: 'interviewed'
                }
            ];
            
            exampleData.forEach(candidate => {
                const row = document.createElement('tr');
                
                // Name
                const nameCell = document.createElement('td');
                nameCell.textContent = candidate.fullname;
                
                // Department
                const departmentCell = document.createElement('td');
                departmentCell.textContent = getDepartmentName(candidate.department);
                
                // Email
                const emailCell = document.createElement('td');
                emailCell.textContent = candidate.email;
                
                // Phone
                const phoneCell = document.createElement('td');
                phoneCell.textContent = candidate.phone;
                
                // Interview progress
                const progressCell = document.createElement('td');
                const progressElement = createInterviewProgress(candidate.progress);
                progressCell.appendChild(progressElement);
                
                // Actions
                const actionsCell = document.createElement('td');
                const updateButton = document.createElement('button');
                updateButton.className = 'btn btn-primary';
                updateButton.textContent = 'Cập nhật';
                updateButton.addEventListener('click', function() {
                    updateInterviewProgress(candidate);
                });
                actionsCell.appendChild(updateButton);
                
                row.appendChild(nameCell);
                row.appendChild(departmentCell);
                row.appendChild(emailCell);
                row.appendChild(phoneCell);
                row.appendChild(progressCell);
                row.appendChild(actionsCell);
                
                keepTrackBody.appendChild(row);
            });
        }

        function createInterviewProgress(progress) {
            const progressElement = document.createElement('div');
            progressElement.className = 'interview-progress';
            
            const steps = [
                { id: 'selected', label: 'Selected' },
                { id: 'checkin', label: 'Check in' },
                { id: 'interviewing', label: 'Interviewing' },
                { id: 'interviewed', label: 'Interviewed' }
            ];
            
            steps.forEach(step => {
                const stepElement = document.createElement('div');
                stepElement.className = 'progress-step';
                
                const circle = document.createElement('div');
                circle.className = 'progress-circle';
                
                if (step.id === progress) {
                    circle.classList.add('active');
                    circle.textContent = '→';
                } else if (
                    (step.id === 'selected' && progress === 'selected') ||
                    (step.id === 'checkin' && (progress === 'checkin' || progress === 'interviewing' || progress === 'interviewed')) ||
                    (step.id === 'interviewing' && (progress === 'interviewing' || progress === 'interviewed')) ||
                    (step.id === 'interviewed' && progress === 'interviewed')
                ) {
                    circle.classList.add('completed');
                    circle.textContent = '✓';
                } else {
                    circle.classList.add('pending');
                    circle.textContent = '○';
                }
                
                const label = document.createElement('div');
                label.className = 'progress-label';
                label.textContent = step.label;
                
                stepElement.appendChild(circle);
                stepElement.appendChild(label);
                progressElement.appendChild(stepElement);
            });
            
            return progressElement;
        }

        function updateInterviewProgress(candidate) {
            // In a real implementation, this would update the candidate's progress in Firestore
            alert(`Cập nhật tiến trình phỏng vấn cho ${candidate.fullname}`);
        }
    </script>
</body>
</html>