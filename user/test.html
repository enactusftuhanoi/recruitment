<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application form | Enactus FTU Hanoi</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary: #f5f5f5;
            --accent: #ff5722;
            --text: #333;
            --text-light: #777;
            --success: #4caf50;
            --error: #f44336;
            --border: #ddd;
            --light-blue: #e8f0fe;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            background: white;
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(120deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transform: rotate(30deg);
        }
        
        .logo {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
            position: relative;
        }
        
        .logo i {
            font-size: 42px;
            margin-right: 15px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .logo h1 {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .header-content p {
            font-size: 18px;
            margin-top: 10px;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .progress-bar {
            display: flex;
            justify-content: space-between;
            padding: 25px 50px;
            background: var(--secondary);
            border-bottom: 1px solid var(--border);
            position: relative;
        }
        
        .step {
            text-align: center;
            position: relative;
            flex: 1;
            z-index: 2;
        }
        
        .step:not(:last-child):after {
            content: '';
            position: absolute;
            top: 22px;
            right: -50%;
            width: 100%;
            height: 3px;
            background: var(--border);
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 10px;
            position: relative;
            z-index: 2;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .step.active .step-number {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 10px rgba(26, 115, 232, 0.3);
        }
        
        .step.completed .step-number {
            background: var(--success);
            color: white;
            border-color: var(--success);
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }
        
        .step.completed:after {
            background: var(--success);
        }
        
        .step-label {
            font-size: 14px;
            color: var(--text-light);
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .step.active .step-label {
            color: var(--primary);
            font-weight: 600;
        }
        
        .form-container {
            padding: 35px;
        }
        
        .form-section {
            display: none;
        }
        
        .form-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h2 {
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-blue);
            font-size: 24px;
            position: relative;
        }
        
        h2::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 70px;
            height: 3px;
            background: var(--primary);
            border-radius: 3px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text);
            font-size: 15px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            font-family: 'Roboto', sans-serif;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .required:after {
            content: " *";
            color: var(--error);
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            background: #f9f9f9;
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .checkbox-item:hover {
            background: #f0f0f0;
        }
        
        .checkbox-item input {
            width: auto;
            margin-right: 10px;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 35px;
        }
        
        button {
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-prev {
            background: #f1f1f1;
            color: var(--text);
        }
        
        .btn-prev:hover {
            background: #e2e2e2;
            transform: translateX(-3px);
        }
        
        .btn-next, .btn-submit {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.25);
        }
        
        .btn-next:hover, .btn-submit:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(26, 115, 232, 0.35);
        }
        
        .success-message {
            text-align: center;
            padding: 50px 40px;
            display: none;
            animation: fadeIn 0.8s ease;
        }
        
        .success-message i {
            font-size: 70px;
            color: var(--success);
            margin-bottom: 25px;
            animation: scaleUp 0.5s ease;
        }
        
        @keyframes scaleUp {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .success-message h2 {
            color: var(--success);
            border: none;
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        .success-message h2::after {
            display: none;
        }
        
        .success-message p {
            font-size: 17px;
            line-height: 1.6;
            color: var(--text-light);
            max-width: 600px;
            margin: 0 auto;
        }
        
        footer {
            text-align: center;
            padding: 25px;
            background: var(--secondary);
            color: var(--text-light);
            font-size: 14px;
            border-top: 1px solid var(--border);
        }
        
        .position-container {
            display: flex;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .position-box {
            flex: 1;
            padding: 20px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: #f9f9f9;
            transition: all 0.3s;
        }
        
        .position-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        
        .position-box h3 {
            margin-bottom: 18px;
            color: var(--primary);
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .position-box h3 i {
            font-size: 20px;
        }
        
        .position-detail {
            background: var(--light-blue);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .position-detail h4 {
            margin-bottom: 15px;
            color: var(--primary-dark);
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .position-detail h4 i {
            font-size: 20px;
        }
        
        .sub-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: #f9f9f9;
        }
        
        .sub-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        /* Styles for different question types */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
            background: #f9f9f9;
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .radio-item:hover {
            background: #f0f0f0;
        }
        
        .radio-item input {
            width: auto;
            margin-right: 10px;
        }
        
        .scale-container {
            margin-top: 10px;
        }
        
        .scale-container input[type="range"] {
            width: 100%;
            margin: 10px 0;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            outline: none;
            border-radius: 4px;
        }
        
        .scale-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }
        
        .scale-labels {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--text-light);
            margin-top: 5px;
        }
        
        .scale-container output {
            display: block;
            text-align: center;
            font-weight: bold;
            margin-top: 5px;
            font-size: 16px;
            color: var(--primary);
        }
        
        .grid-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .grid-item {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            transition: all 0.2s;
        }
        
        .grid-item:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
        }
        
        .time-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .time-input input {
            flex: 1;
        }
        
        /* New styles for application type selection */
        .application-type-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .application-type {
            flex: 1;
            padding: 25px;
            border: 2px solid var(--border);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .application-type:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .application-type.selected {
            border-color: var(--primary);
            background-color: var(--light-blue);
        }
        
        .application-type i {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .application-type h3 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .application-type p {
            color: var(--text-light);
            font-size: 14px;
        }
        
        /* Styles for MD sub-department selection */
        .md-sub-departments {
            margin-top: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        
        /* Tab styles for section 3 */
        .tab-container {
            margin-bottom: 25px;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .tab-button {
            padding: 12px 24px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .tab-button.active {
            background: var(--primary);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
      
        @media (max-width: 900px) {
            .progress-bar {
                padding: 20px 30px;
            }
            
            .step:not(:last-child):after {
                right: -40%;
            }
            
            .form-container {
                padding: 25px;
            }
            
            .position-container {
                flex-direction: column;
            }
            
            .application-type-container {
                flex-direction: column;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .container {
                border-radius: 12px;
            }
            
            header {
                padding: 25px 20px;
            }
            
            .logo h1 {
                font-size: 26px;
            }
            
            .progress-bar {
                padding: 15px 20px;
                flex-wrap: wrap;
            }
            
            .step {
                flex: 0 0 50%;
                margin-bottom: 20px;
            }
            
            .step:not(:last-child):after {
                display: none;
            }
            
            .form-container {
                padding: 20px;
            }
            
            .buttons {
                flex-direction: column;
                gap: 12px;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
            
            h2 {
                font-size: 22px;
            }
            
            .tab-buttons {
                flex-wrap: wrap;
            }
            
            .tab-button {
                margin-bottom: 5px;
            }
        }
        
        @media (max-width: 480px) {
            .step {
                flex: 0 0 100%;
            }
            
            .logo {
                flex-direction: column;
                text-align: center;
            }
            
            .logo i {
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .checkbox-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .checkbox-item {
                width: 100%;
            }
        }
    </style>
    
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-handshake"></i>
                <h1>Enactus FTU Hanoi</h1>
            </div>
            <div class="header-content">
                <p>18th Gen Membership Recruitment</p>
            </div>
        </header>
        
        <div class="progress-bar">
            <div class="step active" id="step0">
                <div class="step-number">0</div>
                <div class="step-label">Hình thức ứng tuyển</div>
            </div>
            <div class="step" id="step1">
                <div class="step-number">1</div>
                <div class="step-label">Thông tin cá nhân</div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div class="step-label">Vị trí ứng tuyển</div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div class="step-label">Chi tiết ứng tuyển</div>
            </div>
            <div class="step" id="step4">
                <div class="step-number">4</div>
                <div class="step-label">Xác nhận</div>
            </div>
        </div>
        
        <div class="form-container">
            <form id="recruitmentForm" novalidate>
                <!-- Section 0: Application Type -->
                <div class="form-section active" id="section0">
                    <h2><i class="fas fa-clipboard-list"></i> Hình thức ứng tuyển</h2>
                    
                    <div class="application-type-container">
                        <div class="application-type" id="type-form" onclick="selectApplicationType('form')">
                            <i class="fas fa-file-alt"></i>
                            <h3>Điền đơn ứng tuyển</h3>
                            <p>Hoàn thành đơn ứng tuyển trực tuyến với đầy đủ thông tin và câu hỏi</p>
                        </div>
                        
                        <div class="application-type" id="type-interview" onclick="selectApplicationType('interview')">
                            <i class="fas fa-microphone"></i>
                            <h3>Phỏng vấn trực tiếp</h3>
                            <p>Chỉ cần cung cấp thông tin cơ bản và tham gia phỏng vấn trực tiếp thay cho việc điền đơn</p>
                        </div>
                    </div>
                    
                    <input type="hidden" id="application_type" name="application_type" value="">
                    
                    <div class="buttons">
                        <div></div>
                        <button type="button" class="btn-next" onclick="nextSection(0)">
                            Tiếp theo <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Section 1: Personal Information -->
                <div class="form-section" id="section1">
                    <h2><i class="fas fa-user-circle"></i> Thông tin cá nhân</h2>
                    
                    <div class="form-group">
                        <label for="fullname" class="required">Họ và tên</label>
                        <input type="text" id="fullname" name="fullname" required>
                    </div>
                    <div class="form-group">
                        <label for="birthdate" class="required">Ngày/tháng/năm sinh</label>
                        <input type="date" id="birthdate" name="birthdate" required>
                    </div>

                    <div class="form-group">
                        <label for="gender" class="required">Giới tính</label>
                        <select id="gender" name="gender" required>
                            <option value="">-- Chọn giới tính --</option>
                            <option value="Nam">Nam</option>
                            <option value="Nữ">Nữ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="email" class="required">Email</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone" class="required">Số điện thoại</label>
                        <input type="tel" id="phone" name="phone" required>
                    </div>

                    <div class="form-group">
                        <label for="school" class="required">Trường đang theo học</label>
                        <input type="text" id="school" name="school" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="major" class="required">Khóa/Chuyên ngành đang theo học</label>
                        <input type="text" id="major" name="major" required>
                    </div>

                    <div class="form-group">
                        <label for="facebook" class="required">Link Facebook</label>
                        <input type="url" id="facebook" name="facebook" placeholder="https://facebook.com/username" required>
                    </div>
                    
                    <div class="buttons">
                        <button type="button" class="btn-prev" onclick="prevSection(1)">
                            <i class="fas fa-arrow-left"></i> Quay lại
                        </button>
                        <button type="button" class="btn-next" onclick="nextSection(1)">
                            Tiếp theo <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Section 2: Position Application -->
                <div class="form-section" id="section2">
                    <h2><i class="fas fa-briefcase"></i> Vị trí ứng tuyển</h2>
                    
                    <div class="position-container">
                        <div class="position-box">
                            <h3><i class="fas fa-star"></i> Bạn muốn đăng ký vào ban nào ? <span class="required"></span></h3>
                            <div class="form-group">
                                <label for="priority_position" class="required">Ban mong muốn nhất (Ưu tiên)</label>
                                <select id="priority_position" name="priority_position" required onchange="updateSecondaryOptions(); updateMDSubDepartments(); updatePositionNames();">
                                    <option value="">-- Chọn vị trí --</option>
                                    <option value="MD">Ban Truyền thông</option>
                                    <option value="HR">Ban Nhân sự</option>
                                    <option value="ER">Ban Đối ngoại</option>
                                    <option value="PD">Ban Nội dung</option>
                                </select>
                            </div>
                            
                            <!-- MD Sub-departments (only visible when MD is selected) -->
                            <div class="md-sub-departments" id="md-sub-departments" style="display: none;">
                                <h4>Tiểu ban Truyền thông</h4>
                                <p>Bạn có thể chọn một hoặc cả hai tiểu ban:</p>
                                <div class="checkbox-group">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="md_design" name="md_sub_departments[]" value="Design">
                                        <label for="md_design">Design</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="md_content" name="md_sub_departments[]" value="Content">
                                        <label for="md_content">Content</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="position-box">
                            <h3><i class="fas fa-clock"></i> Bạn có nguyện vọng đăng ký vào ban nào khác không ?</h3>
                            <div class="form-group">
                                <label for="secondary_position">Ban quan tâm khác</label>
                                <select id="secondary_position" name="secondary_position" onchange="updateMDSubDepartments(); updatePositionNames();">
                                    <option value="">-- Chọn vị trí --</option>
                                    <option value="None">Không chọn</option>
                                    <option value="MD">Ban Truyền thông</option>
                                    <option value="HR">Ban Nhân sự</option>
                                    <option value="ER">Ban Đối ngoại</option>
                                    <option value="PD">Ban Nội dung</option>
                                </select>
                            </div>
                            
                            <!-- MD Sub-departments for secondary position (only visible when MD is selected) -->
                            <div class="md-sub-departments" id="md-sub-departments-secondary" style="display: none;">
                                <h4>Tiểu ban Truyền thông (dự bị)</h4>
                                <p>Bạn có thể chọn một hoặc cả hai tiểu ban:</p>
                                <div class="checkbox-group">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="md_design_secondary" name="md_sub_departments_secondary[]" value="Design">
                                        <label for="md_design_secondary">Design</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="md_content_secondary" name="md_sub_departments_secondary[]" value="Content">
                                        <label for="md_content_secondary">Content</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="availability" class="required">Bạn có thể dành bao nhiêu thời gian cho Enactus?</label>
                        <select id="availability" name="availability" required>
                            <option value="">-- Chọn mức độ --</option>
                            <option value="5-10">5-10 giờ/tuần</option>
                            <option value="10-15">10-15 giờ/tuần</option>
                            <option value="15-20">15-20 giờ/tuần</option>
                            <option value="20+">Trên 20 giờ/tuần</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="motivation">Tại sao bạn muốn tham gia Enactus?</label>
                        <textarea id="motivation" name="motivation" rows="4" placeholder="Hãy chia sẻ lý do bạn muốn trở thành thành viên của Enactus FTU Hanoi..."></textarea>
                    </div>
                    
                    <div class="buttons">
                        <button type="button" class="btn-prev" onclick="prevSection(2)">
                            <i class="fas fa-arrow-left"></i> Quay lại
                        </button>
                        <button type="button" class="btn-next" onclick="nextSection(2)">
                            Tiếp theo <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Section 3: Experience and Skills -->
                <div class="form-section" id="section3">
                    <h2><i class="fas fa-tasks"></i> Chi tiết ứng tuyển</h2>
                    
                    <div class="tab-container">
                        <div class="tab-buttons">
                            <button type="button" class="tab-button active" onclick="showTab('general')">Câu hỏi chung</button>
                            <button type="button" class="tab-button" onclick="showTab('priority')" id="priority-tab-btn">Câu hỏi dành cho ban ... (Ưu tiên)</button>
                            <button type="button" class="tab-button" onclick="showTab('secondary')" id="secondary-tab-btn" style="display: none;">Câu hỏi dành cho ban ... (Dự bị)</button>
                        </div>
                        
                        <div id="tab-general" class="tab-content active">
                          <h3><i class="fas fa-info-circle"></i> Câu hỏi chung</h3>
                          <div id="general-questions"></div>
                        </div>

                        
                        <div class="tab-content" id="tab-priority">
                            <div class="form-group">
                                <label for="priority_experience" class="required">Kinh nghiệm và hiểu biết về vị trí này</label>
                                <textarea id="priority_experience" name="priority_experience" rows="4" placeholder="Hãy mô tả kinh nghiệm, hiểu biết của bạn về vị trí này và tại sao bạn phù hợp..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="priority_motivation" class="required">Động lực ứng tuyển vị trí này</label>
                                <textarea id="priority_motivation" name="priority_motivation" rows="4" placeholder="Tại sao bạn chọn vị trí này làm ưu tiên hàng đầu?..." required></textarea>
                            </div>
                            
                            <!-- Câu hỏi dành riêng cho phân ban ưu tiên -->
                            <div class="sub-section">
                                <h3><i class="fas fa-question-circle"></i> Câu hỏi dành riêng cho <span id="ban-name">vị trí ưu tiên</span></h3>
                                <div id="ban-specific-questions">
                                    <!-- Câu hỏi sẽ được tự động thêm vào đây bằng JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="tab-secondary">
                            <div class="form-group">
                                <label for="secondary_experience">Kinh nghiệm và hiểu biết về vị trí dự bị (nếu có)</label>
                                <textarea id="secondary_experience" name="secondary_experience" rows="4" placeholder="Nếu bạn đã chọn vị trí dự bị, hãy chia sẻ kinh nghiệm và hiểu biết của bạn về vị trí này..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="secondary_motivation">Lý do chọn vị trí dự bị này</label>
                                <textarea id="secondary_motivation" name="secondary_motivation" rows="4" placeholder="Tại sao bạn chọn vị trí này làm dự bị?..."></textarea>
                            </div>
                            
                            <!-- Câu hỏi dành riêng cho phân ban dự bị -->
                            <div class="sub-section">
                                <h3><i class="fas fa-question-circle"></i> Câu hỏi dành riêng cho <span id="secondary-ban-name">vị trí dự bị</span></h3>
                                <div id="secondary-ban-specific-questions">
                                    <!-- Câu hỏi sẽ được tự động thêm vào đây bằng JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="buttons">
                        <button type="button" class="btn-prev" onclick="prevSection(3)">
                            <i class="fas fa-arrow-left"></i> Quay lại
                        </button>
                        <button type="button" class="btn-next" onclick="nextSection(3)">
                            Tiếp theo <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Section 4: Confirmation -->
                <div class="form-section" id="section4">
                    <h2><i class="fas fa-check-circle"></i> Xác nhận thông tin</h2>
                    
                    <div class="form-group">
                        <p>Vui lòng kiểm tra lại thông tin trước khi gửi:</p>
                        <div id="summary" style="background: #f9f9f9; padding: 25px; border-radius: 10px; margin-top: 20px; border-left: 4px solid var(--primary);"></div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-item" style="background: transparent; padding: 0;">
                            <input type="checkbox" id="agree" name="agree" required>
                            <label for="agree" class="required">Tôi xác nhận rằng tất cả thông tin trên là chính xác</label>
                        </div>
                    </div>
                    
                    <div class="buttons">
                        <button type="button" class="btn-prev" onclick="prevSection(4)">
                            <i class="fas fa-arrow-left"></i> Quay lại
                        </button>
                        <button type="submit" class="btn-submit">
                            <i class="fas fa-paper-plane"></i> Gửi đơn ứng tuyển
                        </button>
                    </div>
                </div>
            </form>
            
            <!-- Success Message -->
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i>
                <h2>Đơn ứng tuyển đã được gửi thành công!</h2>
                <p>Cảm ơn bạn đã nộp đơn ứng tuyển đến Enactus FTU Hanoi. Chúng tôi sẽ liên hệ với bạn trong thời gian sớm nhất qua email hoặc số điện thoại bạn đã cung cấp.</p>
            </div>
        </div>
        
        <footer>
            <p>© 2025 Enactus FTU Hanoi - All rights reserved</p>
        </footer>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAOP2j0qV0Ge-q2-Y9zo9Qc3eLmgtVOK3k",
            authDomain: "recruitment-enactusftuhanoi.firebaseapp.com",
            projectId: "recruitment-enactusftuhanoi",
            storageBucket: "recruitment-enactusftuhanoi.firebasestorage.app",
            messagingSenderId: "658928769643",
            appId: "1:658928769643:web:ef4e26633b7c41c922ef2e",
            measurementId: "G-BJT7ZPKYE3"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        const generalQuestions = [
          {
            type: 'text',
            id: 'intro',
            question: 'Giới thiệu bản thân',
            placeholder: 'Mô tả ngắn gọn về bản thân, tính cách, điểm mạnh và mong muốn của bạn...',
            required: true
          },
          // bạn có thể bổ sung các câu hỏi chung khác ở đây
        ];

        // Định nghĩa bộ câu hỏi cho từng phân ban
       const banQuestions = {
            'MD': { // Ban Truyền thông phân ra 2 tiểu ban
              'Design': [
                {
                  type: 'textarea',
                  id: 'design_exp',
                  question: 'Bạn đã có kinh nghiệm với phần mềm thiết kế nào?',
                  placeholder: 'Mô tả kinh nghiệm với Photoshop, Illustrator, Figma, Canva...',
                  required: true
                },
                {
                  type: 'scale',
                  id: 'creativity',
                  question: 'Đánh giá khả năng sáng tạo của bạn (1-10)',
                  min: 1,
                  max: 10,
                  required: true
                },
                {
                  type: 'radio',
                  id: 'design_level',
                  question: 'Mức độ kinh nghiệm thiết kế của bạn?',
                  options: ['Mới bắt đầu', 'Có một ít kinh nghiệm', 'Khá thành thạo', 'Rất thành thạo'],
                  required: true
                }
              ],
              'Content': [
                {
                  type: 'checkbox',
                  id: 'platforms',
                  question: 'Bạn có kinh nghiệm với nền tảng mạng xã hội nào?',
                  options: ['Facebook', 'Instagram', 'TikTok', 'YouTube', 'LinkedIn'],
                  required: true
                },
                {
                  type: 'radio',
                  id: 'content_level',
                  question: 'Mức độ kinh nghiệm của bạn trong nội dung/truyền thông?',
                  options: ['Mới bắt đầu', 'Có một ít kinh nghiệm', 'Khá thành thạo', 'Rất thành thạo'],
                  required: true
                },
                {
                  type: 'scale',
                  id: 'research_skill',
                  question: 'Đánh giá khả năng nghiên cứu & lên ý tưởng nội dung (1-10)',
                  min: 1,
                  max: 10,
                  required: true
                }
              ]
            },
            'HR': [ // Ban Nhân sự
                {
                    type: 'textarea',
                    id: 'hr_organization',
                    question: 'Bạn đã từng tổ chức sự kiện nào chưa? Mô tả ngắn gọn.',
                    placeholder: 'Mô tả kinh nghiệm tổ chức sự kiện...',
                    required: false
                },
                {
                    type: 'dropdown',
                    id: 'hr_team_size',
                    question: 'Quy mô nhóm lớn nhất bạn từng quản lý?',
                    options: ['Dưới 5 người', '5-10 người', '10-20 người', 'Trên 20 người'],
                    required: true
                },
                {
                    type: 'checkbox',
                    id: 'hr_skills',
                    question: 'Kỹ năng nào bạn có thể đóng góp cho ban Nhân sự?',
                    options: ['Giao tiếp', 'Quản lý thời gian', 'Giải quyết vấn đề', 'Lập kế hoạch', 'Đàm phán'],
                    required: true
                }
            ],
            'ER': [ // Ban Đối ngoại
                {
                    type: 'textarea',
                    id: 'er_negotiation',
                    question: 'Kể về kinh nghiệm đàm phán/thương lượng của bạn',
                    placeholder: 'Mô tả tình huống bạn đã đàm phán thành công...',
                    required: true
                },
                {
                    type: 'radio',
                    id: 'er_partner_type',
                    question: 'Bạn muốn làm việc với đối tác thuộc lĩnh vực nào?',
                    options: ['Doanh nghiệp', 'Tổ chức giáo dục', 'Tổ chức phi chính phủ', 'Cá nhân influencers'],
                    required: true
                },
                {
                    type: 'date',
                    id: 'er_availability',
                    question: 'Bạn có thể bắt đầu tham gia từ khi nào?',
                    required: true
                }
            ],
            'PD': [ // Ban Nội dung
                {
                    type: 'textarea',
                    id: 'pd_writing_samples',
                    question: 'Mô tả các loại nội dung bạn đã từng sáng tạo',
                    placeholder: 'Bài blog, kịch bản video, nội dung MXH, bài PR...',
                    required: true
                },
                {
                    type: 'radio',
                    id: 'pd_content_type',
                    question: 'Bạn hứng thú nhất với loại nội dung nào?',
                    options: ['Nội dung viết (blog, article)', 'Nội dung hình ảnh (infographic)', 'Nội dung video', 'Nội dung truyền thông xã hội'],
                    required: true
                },
                {
                    type: 'scale',
                    id: 'pd_research_skill',
                    question: 'Đánh giá kỹ năng nghiên cứu và tổng hợp thông tin của bạn (1-10)',
                    min: 1,
                    max: 10,
                    required: true
                }
            ]
        };
      
        // Biến toàn cục để lưu hình thức ứng tuyển
        let applicationType = '';
        let currentSection = 0;
        const totalSections = 4;
        
        // Hàm chọn hình thức ứng tuyển
        function selectApplicationType(type) {
            applicationType = type;
            document.getElementById('application_type').value = type;
            
            // Cập nhật giao diện
            document.querySelectorAll('.application-type').forEach(el => {
                el.classList.remove('selected');
            });
            document.getElementById(`type-${type}`).classList.add('selected');
        }
        
        // Hàm hiển thị câu hỏi chung
        function renderGeneralQuestions() {
          const container = document.getElementById('general-questions');
          container.innerHTML = '';
        
          generalQuestions.forEach(q => {
            const div = document.createElement('div');
            div.className = 'form-group question-item';
            let html = `<label for="general_${q.id}" ${q.required ? 'class="required"' : ''}>${q.question}</label>`;
        
            switch (q.type) {
              case 'textarea':
                html += `<textarea id="general_${q.id}" name="general_${q.id}" rows="3" placeholder="${q.placeholder || ''}" ${q.required ? 'required' : ''}></textarea>`;
                break;
        
              case 'email':
              case 'tel':
              case 'date':
              case 'text':
                html += `<input type="${q.type}" id="general_${q.id}" name="general_${q.id}" placeholder="${q.placeholder || ''}" ${q.required ? 'required' : ''}>`;
                break;
        
              default:
                html += `<input type="text" id="general_${q.id}" name="general_${q.id}" placeholder="${q.placeholder || ''}" ${q.required ? 'required' : ''}>`;
            }
        
            div.innerHTML = html;
            container.appendChild(div);
          });
        }

        // Hàm hiển thị câu hỏi theo phân ban
        function renderBanQuestions(banCode, type) {
            // container: 'priority' -> ban-specific-questions ; 'secondary' -> secondary-ban-specific-questions
            const containerId = type === 'priority' ? 'ban-specific-questions' : 'secondary-ban-specific-questions';
            const questionsContainer = document.getElementById(containerId);
            questionsContainer.innerHTML = '';
        
            if (!banCode) {
                questionsContainer.innerHTML = '<p class="no-questions">Vui lòng chọn ban để hiển thị câu hỏi phù hợp.</p>';
                return;
            }
        
            // Helper để render 1 câu hỏi (q) với prefixedId
            function renderQuestion(q, prefixedId) {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'form-group question-item';
        
                let html = `<label for="${prefixedId}" ${q.required ? 'class="required"' : ''}>${q.question}</label>`;
        
                switch (q.type) {
                    case 'textarea':
                        html += `<textarea id="${prefixedId}" name="${prefixedId}" rows="3" placeholder="${q.placeholder || ''}" ${q.required ? 'required' : ''}></textarea>`;
                        break;
        
                    case 'checkbox':
                        html += `<div class="checkbox-group" id="${prefixedId}_group">`;
                        q.options.forEach((option, idx) => {
                            const optionId = `${prefixedId}_${idx}`;
                            html += `<div class="checkbox-item">
                                        <input type="checkbox" id="${optionId}" name="${prefixedId}[]" value="${option}">
                                        <label for="${optionId}">${option}</label>
                                     </div>`;
                        });
                        html += `</div>`;
                        if (q.required) {
                            html += `<input type="hidden" name="${prefixedId}_required" value="true" data-required-message="Vui lòng chọn ít nhất một tùy chọn">`;
                        }
                        break;
        
                    case 'radio':
                        html += `<div class="radio-group" id="${prefixedId}_group">`;
                        q.options.forEach((option, idx) => {
                            const optionId = `${prefixedId}_${idx}`;
                            html += `<div class="radio-item">
                                        <input type="radio" id="${optionId}" name="${prefixedId}" value="${option}">
                                        <label for="${optionId}">${option}</label>
                                     </div>`;
                        });
                        html += `</div>`;
                        if (q.required) {
                            html += `<input type="hidden" name="${prefixedId}_required" value="true" data-required-message="Vui lòng chọn một tùy chọn">`;
                        }
                        break;
        
                    case 'dropdown':
                        html += `<select id="${prefixedId}" name="${prefixedId}" ${q.required ? 'required' : ''}>`;
                        html += `<option value="">-- Chọn --</option>`;
                        q.options.forEach(opt => {
                            html += `<option value="${opt}">${opt}</option>`;
                        });
                        html += `</select>`;
                        break;
        
                    case 'scale':
                        const mid = Math.round((q.min + q.max) / 2);
                        html += `<div class="scale-container">
                                    <input type="range" id="${prefixedId}" name="${prefixedId}" min="${q.min}" max="${q.max}" value="${mid}" ${q.required ? 'required' : ''}>
                                    <div class="scale-labels"><span>${q.min}</span><span>${q.max}</span></div>
                                    <output for="${prefixedId}" id="${prefixedId}_value">${mid}</output>
                                 </div>`;
                        break;
        
                    case 'date':
                        html += `<input type="date" id="${prefixedId}" name="${prefixedId}" ${q.required ? 'required' : ''}>`;
                        break;
        
                    default:
                        html += `<input type="text" id="${prefixedId}" name="${prefixedId}" placeholder="${q.placeholder || ''}" ${q.required ? 'required' : ''}>`;
                }
        
                questionDiv.innerHTML = html;
                questionsContainer.appendChild(questionDiv);
        
                // Nếu là scale, add listener để cập nhật output
                if (q.type === 'scale') {
                    const range = document.getElementById(prefixedId);
                    const out = document.getElementById(`${prefixedId}_value`);
                    if (range && out) {
                        range.addEventListener('input', () => { out.value = range.value; });
                    }
                }
            }
        
            // --- Nếu ban là MD: dùng tiểu ban (Design / Content) để quyết định bộ câu hỏi ---
            if (banCode === 'MD') {
                const designCheckbox = document.getElementById(type === 'priority' ? 'md_design' : 'md_design_secondary');
                const contentCheckbox = document.getElementById(type === 'priority' ? 'md_content' : 'md_content_secondary');
        
                const selected = [];
                if (designCheckbox && designCheckbox.checked) selected.push('Design');
                if (contentCheckbox && contentCheckbox.checked) selected.push('Content');
        
                if (selected.length === 0) {
                    questionsContainer.innerHTML = '<p class="no-questions">Vui lòng chọn tiểu ban Design hoặc Content để hiển thị câu hỏi.</p>';
                    return;
                }
        
                selected.forEach(sub => {
                    // tiêu đề phụ cho từng tiểu ban
                    const subtitle = document.createElement('div');
                    subtitle.className = 'sub-section';
                    subtitle.innerHTML = `<h3>Tiểu ban ${sub}</h3>`;
                    questionsContainer.appendChild(subtitle);
        
                    const questions = (banQuestions['MD'] && banQuestions['MD'][sub]) || [];
                    questions.forEach(q => {
                        // prefixedId: "priority_design_design_exp" hoặc "secondary_content_platforms", tránh trùng
                        const prefixedId = `${type}_${sub.toLowerCase()}_${q.id}`;
                        renderQuestion(q, prefixedId);
                    });
                });
        
                return; // xong MD
            }
        
            // --- Non-MD: render như cũ (mỗi ban có 1 mảng câu hỏi) ---
            const questions = banQuestions[banCode] || [];
            if (!questions.length) {
                questionsContainer.innerHTML = '<p class="no-questions">Không có câu hỏi cụ thể cho phân ban này.</p>';
                return;
            }
        
            questions.forEach(q => {
                const prefixedId = `${type}_${q.id}`;
                renderQuestion(q, prefixedId);
            });
        }
        
        function updateProgressBar() {
            // Reset all steps
            for (let i = 0; i <= totalSections; i++) {
                document.getElementById(`step${i}`).className = 'step';
            }
            
            // Mark previous steps as completed and current as active
            for (let i = 0; i < currentSection; i++) {
                document.getElementById(`step${i}`).className = 'step completed';
            }
            
            document.getElementById(`step${currentSection}`).className = 'step active';
        }
        
        function showSection(sectionNumber) {
            // Hide all sections
            for (let i = 0; i <= totalSections; i++) {
                document.getElementById(`section${i}`).style.display = 'none';
            }
            
            // Show current section
            document.getElementById(`section${sectionNumber}`).style.display = 'block';
            currentSection = sectionNumber;
            updateProgressBar();
            
            // If it's the confirmation section, generate summary
            if (sectionNumber === 4) {
                generateSummary();
            }
            
            // If it's the experience section, update position names
            if (sectionNumber === 3) {
                updatePositionNames();
            }
        }
        
        function updateSecondaryOptions() {
            const prioritySelect = document.getElementById('priority_position');
            const secondarySelect = document.getElementById('secondary_position');
            const priorityValue = prioritySelect.value;
            
            // Enable all options first
            for (let i = 0; i < secondarySelect.options.length; i++) {
                secondarySelect.options[i].disabled = false;
            }
            
            // Disable the selected priority option in secondary select
            if (priorityValue) {
                for (let i = 0; i < secondarySelect.options.length; i++) {
                    if (secondarySelect.options[i].value === priorityValue) {
                        secondarySelect.options[i].disabled = true;
                        if (secondarySelect.value === priorityValue) {
                            secondarySelect.value = "";
                        }
                        break;
                    }
                }
            }
        }
        
        // Hàm cập nhật hiển thị lựa chọn tiểu ban cho Ban Truyền thông
        function updateMDSubDepartments() {
            const prioritySelect = document.getElementById('priority_position');
            const secondarySelect = document.getElementById('secondary_position');
            
            // Hiển thị/ẩn tiểu ban cho vị trí ưu tiên
            if (prioritySelect.value === 'MD') {
                document.getElementById('md-sub-departments').style.display = 'block';
            } else {
                document.getElementById('md-sub-departments').style.display = 'none';
            }
            
            // Hiển thị/ẩn tiểu ban cho vị trí dự bị
            if (secondarySelect.value === 'MD') {
                document.getElementById('md-sub-departments-secondary').style.display = 'block';
            } else {
                document.getElementById('md-sub-departments-secondary').style.display = 'none';
            }
        }
        
        function updatePositionNames() {
            const prioritySelect = document.getElementById('priority_position');
            const secondarySelect = document.getElementById('secondary_position');
        
            const priorityPositionName = prioritySelect.options[prioritySelect.selectedIndex].text;
            const secondaryPositionName = secondarySelect.options[secondarySelect.selectedIndex].text;
        
            // UPDATE: đổi label của các tab
            // Tab chung
            const generalTabBtn = document.querySelector(`.tab-button[onclick="showTab('general')"]`);
            if (generalTabBtn) generalTabBtn.textContent = 'Câu hỏi chung';
        
            // Tab ưu tiên
            const priorityTabBtn = document.getElementById('priority-tab-btn');
            if (priorityTabBtn) priorityTabBtn.textContent = `Câu hỏi dành cho ban ${priorityPositionName} (Ưu tiên)`;
        
            // Tab dự bị
            const secondaryTabBtn = document.getElementById('secondary-tab-btn');
            if (secondarySelect.value && secondarySelect.value !== "None") {
                if (secondaryTabBtn) {
                    secondaryTabBtn.style.display = 'inline-block';
                    secondaryTabBtn.textContent = `Câu hỏi dành cho ban ${secondaryPositionName} (Dự bị)`;
                }
            } else {
                if (secondaryTabBtn) secondaryTabBtn.style.display = 'none';
            }
        
            // Update header inside các sub-section
            document.getElementById('ban-name').textContent = `${priorityPositionName} (Ưu tiên)`;
            document.getElementById('secondary-ban-name').textContent = secondarySelect.value && secondarySelect.value !== "None" ? `${secondaryPositionName} (Dự bị)` : 'vị trí dự bị';
        
            // Render câu hỏi tương ứng
            renderBanQuestions(prioritySelect.value, 'priority');
            if (secondarySelect.value && secondarySelect.value !== "None") {
                renderBanQuestions(secondarySelect.value, 'secondary');
            }
        }

        
        // Hàm hiển thị tab
        function showTab(tabName) {
            // Ẩn tất cả các tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Hiển thị tab được chọn
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // Cập nhật trạng thái active của các nút tab
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelector(`.tab-button[onclick="showTab('${tabName}')"]`).classList.add('active');
        }
        
        // Hàm validation tùy chỉnh cho checkbox và radio groups
        function validateFormSection(section) {
            let isValid = true;
            
            // Tìm tất cả các hidden required fields
            const requiredHiddenInputs = section.querySelectorAll('input[type="hidden"][name$="_required"]');
            
            requiredHiddenInputs.forEach(hiddenInput => {
                const fieldName = hiddenInput.name.replace('_required', '');
                const fieldType = hiddenInput.name.includes('checkbox') ? 'checkbox' : 'radio';
                
                // Kiểm tra xem có ít nhất một checkbox/radio được chọn không
                let isChecked = false;
                if (fieldType === 'checkbox') {
                    const checkboxes = section.querySelectorAll(`input[type="checkbox"][name="${fieldName}[]"]`);
                    isChecked = Array.from(checkboxes).some(cb => cb.checked);
                } else {
                    const radios = section.querySelectorAll(`input[type="radio"][name="${fieldName}"]`);
                    isChecked = Array.from(radios).some(radio => radio.checked);
                }
                
                if (!isChecked) {
                    isValid = false;
                    // Highlight nhóm
                    const group = section.querySelector(`#${fieldName}_group`);
                    if (group) {
                        group.style.border = '1px solid var(--error)';
                        group.style.padding = '10px';
                        group.style.borderRadius = '8px';
                    }
                }
            });
            
            // Validate các trường required thông thường
            const requiredInputs = section.querySelectorAll('input[required], select[required], textarea[required]');
            
            requiredInputs.forEach(input => {
                if (input.offsetParent !== null && !input.value) { // Chỉ validate các trường visible
                    isValid = false;
                    input.style.borderColor = 'var(--error)';
                    input.style.animation = 'shake 0.5s';
                    setTimeout(() => {
                        input.style.animation = '';
                    }, 500);
                } else {
                    input.style.borderColor = 'var(--border)';
                }
            });
            
            return isValid;
        }
        
        function nextSection(current) {
            // Kiểm tra nếu chưa chọn hình thức ứng tuyển
            if (current === 0 && !applicationType) {
                alert('Vui lòng chọn hình thức ứng tuyển.');
                return;
            }
            
            // Nếu chọn phỏng vấn thay đơn, bỏ qua section 3
            if (current === 2 && applicationType === 'interview') {
                showSection(4);
                return;
            }
            
            // Basic validation
            let valid = true;
            const currentSection = document.getElementById(`section${current}`);
            const requiredInputs = currentSection.querySelectorAll('input[required], select[required], textarea[required]');
            
            requiredInputs.forEach(input => {
                // Kiểm tra radio buttons và checkboxes
                if (input.type === 'radio' || input.type === 'checkbox') {
                    const name = input.name;
                    const checked = currentSection.querySelectorAll(`input[name="${name}"]:checked`).length > 0;
                    
                    if (!checked) {
                        valid = false;
                        // Highlight nhóm câu hỏi
                        const group = input.closest('.radio-group, .checkbox-group');
                        if (group) {
                            group.style.border = '1px solid var(--error)';
                            group.style.padding = '10px';
                            group.style.borderRadius = '8px';
                        }
                    }
                } 
                // Kiểm tra các input khác
                else if (!input.value) {
                    valid = false;
                    input.style.borderColor = 'var(--error)';
                    // Add shake animation for error
                    input.style.animation = 'shake 0.5s';
                    setTimeout(() => {
                        input.style.animation = '';
                    }, 500);
                } else {
                    input.style.borderColor = 'var(--border)';
                }
            });
            
            if (valid) {
                showSection(current + 1);
            } else {
                alert('Vui lòng điền đầy đủ các thông tin bắt buộc.');
            }
        }
        
        function prevSection(current) {
            // Nếu chọn phỏng vấn thay đơn và đang ở section 4, quay lại section 2
            if (current === 4 && applicationType === 'interview') {
                showSection(2);
                return;
            }
            
            showSection(current - 1);
        }
        
        function generateSummary() {
            const form = document.getElementById('recruitmentForm');
            const summaryDiv = document.getElementById('summary');
            
            // Get position names from options
            const priorityPositionText = form.priority_position.options[form.priority_position.selectedIndex].text;
            const secondaryPositionText = form.secondary_position.options[form.secondary_position.selectedIndex].text;
            
            // Get selected MD sub-departments
            let mdSubDepartments = [];
            document.querySelectorAll('input[name="md_sub_departments[]"]:checked').forEach(cb => {
                mdSubDepartments.push(cb.value);
            });
            
            let mdSubDepartmentsSecondary = [];
            document.querySelectorAll('input[name="md_sub_departments_secondary[]"]:checked').forEach(cb => {
                mdSubDepartmentsSecondary.push(cb.value);
            });
            
            let summaryHTML = `
                <p><strong>Hình thức ứng tuyển:</strong> ${applicationType === 'form' ? 'Điền đơn ứng tuyển' : 'Phỏng vấn trực tiếp'}</p>
                <p><strong>Họ và tên:</strong> ${form.fullname.value}</p>
                <p><strong>Ngày/tháng/năm sinh:</strong> ${form.birthdate.value}</p>
                <p><strong>Giới tính:</strong> ${form.gender.value}</p>
                <p><strong>Trường:</strong> ${form.school.value}</p>
                <p><strong>Khóa/Chuyên ngành đang theo học:</strong> ${form.major.value}</p>
                <p><strong>Email:</strong> ${form.email.value}</p>
                <p><strong>Số điện thoại:</strong> ${form.phone.value}</p>
                <p><strong>Bạn muốn đăng ký vào ban:</strong> ${priorityPositionText}</p>
            `;
            
            // Thêm thông tin tiểu ban nếu là Ban Truyền thông
            if (form.priority_position.value === 'MD' && mdSubDepartments.length > 0) {
                summaryHTML += `<p><strong>Tiểu ban Truyền thông:</strong> ${mdSubDepartments.join(', ')}</p>`;
            }
            
            summaryHTML += `<p><strong>Bạn có nguyện vọng đăng ký vào ban:</strong> ${secondaryPositionText === "-- Chọn vị trí --" ? "Không chọn" : secondaryPositionText}</p>`;
            
            // Thêm thông tin tiểu ban dự bị nếu là Ban Truyền thông
            if (form.secondary_position.value === 'MD' && mdSubDepartmentsSecondary.length > 0) {
                summaryHTML += `<p><strong>Tiểu ban Truyền thông (dự bị):</strong> ${mdSubDepartmentsSecondary.join(', ')}</p>`;
            }
            
            summaryDiv.innerHTML = summaryHTML;
        }
        
        // Hàm thu thập tất cả dữ liệu form
        function collectFormData() {
            const formObject = {
                // Hình thức ứng tuyển
                application_type: applicationType,
                
                // Thông tin cá nhân
                fullname: document.getElementById('fullname').value,
                birthdate: document.getElementById('birthdate').value,
                gender: document.getElementById('gender').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                school: document.getElementById('school').value,
                major: document.getElementById('major').value,
                facebook: document.getElementById('facebook').value,
                
                // Vị trí ứng tuyển
                priority_position: document.getElementById('priority_position').value,
                secondary_position: document.getElementById('secondary_position').value,
                availability: document.getElementById('availability').value,
                motivation: document.getElementById('motivation').value,
                
                // Chi tiết ứng tuyển
                intro: document.getElementById('intro').value,
                priority_experience: document.getElementById('priority_experience').value,
                priority_motivation: document.getElementById('priority_motivation').value,
                secondary_experience: document.getElementById('secondary_experience')?.value || '',
                secondary_motivation: document.getElementById('secondary_motivation')?.value || '',
                
                // Tiểu ban Truyền thông
                md_sub_departments: Array.from(document.querySelectorAll('input[name="md_sub_departments[]"]:checked')).map(cb => cb.value),
                md_sub_departments_secondary: Array.from(document.querySelectorAll('input[name="md_sub_departments_secondary[]"]:checked')).map(cb => cb.value),
                
                // Câu hỏi phân ban ưu tiên
                ...collectBanQuestions('priority'),
                
                // Câu hỏi phân ban dự bị (nếu có)
                ...collectBanQuestions('secondary'),
                
                // Timestamp
                timestamp: new Date()
            };
            
            return formObject;
        }
        
        // Hàm thu thập câu hỏi theo phân ban
        function collectBanQuestions(type) {
            const prefix = `${type}_`;
            const questionsData = {};
            
            const containerId = type === 'priority' ? 'ban-specific-questions' : 'secondary-ban-specific-questions';
            const container = document.getElementById(containerId);
            
            if (!container) return questionsData;
            
            const inputs = container.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                // Bỏ qua các hidden required fields
                if (input.name && input.name.startsWith(prefix) && !input.name.endsWith('_required')) {
                    const key = input.name;
                    
                    if (input.type === 'checkbox') {
                        // Xử lý checkbox
                        if (!questionsData[key]) questionsData[key] = [];
                        if (input.checked) {
                            questionsData[key].push(input.value);
                        }
                    } else if (input.type === 'radio') {
                        // Xử lý radio - chỉ lấy giá trị được chọn
                        if (input.checked) {
                            questionsData[key] = input.value;
                        }
                    } else {
                        // Xử lý các input khác
                        questionsData[key] = input.value;
                    }
                }
            });
            
            return questionsData;
        }
        
        // Hàm lưu dữ liệu tạm vào localStorage
        function saveFormData() {
            try {
                const formData = collectFormData();
                localStorage.setItem('enactus_form_data', JSON.stringify(formData));
                console.log('Form data saved temporarily');
            } catch (error) {
                console.error('Error saving form data:', error);
            }
        }
        
        // Hàm khôi phục dữ liệu từ localStorage
        function loadFormData() {
            try {
                const savedData = localStorage.getItem('enactus_form_data');
                if (savedData) {
                    const formData = JSON.parse(savedData);
                    
                    // Khôi phục hình thức ứng tuyển
                    if (formData.application_type) {
                        selectApplicationType(formData.application_type);
                    }
                    
                    // Khôi phục thông tin cá nhân
                    if (formData.fullname) document.getElementById('fullname').value = formData.fullname;
                    if (formData.birthdate) document.getElementById('birthdate').value = formData.birthdate;
                    if (formData.gender) document.getElementById('gender').value = formData.gender;
                    if (formData.email) document.getElementById('email').value = formData.email;
                    if (formData.phone) document.getElementById('phone').value = formData.phone;
                    if (formData.school) document.getElementById('school').value = formData.school;
                    if (formData.major) document.getElementById('major').value = formData.major;
                    if (formData.facebook) document.getElementById('facebook').value = formData.facebook;
                    
                    // Khôi phục vị trí ứng tuyển
                    if (formData.priority_position) {
                        document.getElementById('priority_position').value = formData.priority_position;
                        updateSecondaryOptions();
                        updateMDSubDepartments();
                    }
                    if (formData.secondary_position) document.getElementById('secondary_position').value = formData.secondary_position;
                    if (formData.availability) document.getElementById('availability').value = formData.availability;
                    if (formData.motivation) document.getElementById('motivation').value = formData.motivation;
                    
                    // Khôi phục tiểu ban Truyền thông
                    if (formData.md_sub_departments) {
                        formData.md_sub_departments.forEach(value => {
                            const checkbox = document.querySelector(`input[name="md_sub_departments[]"][value="${value}"]`);
                            if (checkbox) checkbox.checked = true;
                        });
                    }
                    
                    if (formData.md_sub_departments_secondary) {
                        formData.md_sub_departments_secondary.forEach(value => {
                            const checkbox = document.querySelector(`input[name="md_sub_departments_secondary[]"][value="${value}"]`);
                            if (checkbox) checkbox.checked = true;
                        });
                    }
                    
                    // Khôi phục chi tiết ứng tuyển
                    if (formData.intro) document.getElementById('intro').value = formData.intro;
                    if (formData.priority_experience) document.getElementById('priority_experience').value = formData.priority_experience;
                    if (formData.priority_motivation) document.getElementById('priority_motivation').value = formData.priority_motivation;
                    if (formData.secondary_experience) document.getElementById('secondary_experience').value = formData.secondary_experience;
                    if (formData.secondary_motivation) document.getElementById('secondary_motivation').value = formData.secondary_motivation;
                    
                    // Cập nhật tên phân ban và câu hỏi
                    updatePositionNames();
                    
                    console.log('Form data loaded from temporary storage');
                }
            } catch (error) {
                console.error('Error loading form data:', error);
            }
        }
        
        // Handle form submission
        document.getElementById('recruitmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Check if agreement is checked
            if (!document.getElementById('agree').checked) {
                alert('Vui lòng xác nhận rằng tất cả thông tin bạn cung cấp là chính xác.');
                return;
            }
            
            const form = document.getElementById('recruitmentForm');
            
            // Show loading state
            const submitBtn = form.querySelector('.btn-submit');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang gửi...';
            submitBtn.disabled = true;
            
            try {
                // Lấy tất cả dữ liệu từ form
                const formObject = collectFormData();
                
                // Nếu là hình thức phỏng vấn, xóa dữ liệu section 3
                if (applicationType === 'interview') {
                    delete formObject.intro;
                    delete formObject.priority_experience;
                    delete formObject.priority_motivation;
                    delete formObject.secondary_experience;
                    delete formObject.secondary_motivation;
                    
                    // Xóa tất cả câu hỏi phân ban
                    Object.keys(formObject).forEach(key => {
                        if (key.startsWith('priority_') || key.startsWith('secondary_')) {
                            delete formObject[key];
                        }
                    });
                }
                
                // Save to Firebase
                await db.collection('applications').add(formObject);
                
                // Xóa dữ liệu tạm sau khi gửi thành công
                localStorage.removeItem('enactus_form_data');
                
                // Hide form and show success message
                form.style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                
                console.log('Application submitted successfully:', formObject);
            } catch (error) {
                console.error('Error submitting application:', error);
                alert('Có lỗi xảy ra khi gửi đơn ứng tuyển. Vui lòng thử lại sau. Chi tiết lỗi: ' + error.message);
                
                // Reset button state
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });
        
        // Thêm sự kiện lưu dữ liệu khi người dùng rời khỏi trang
        window.addEventListener('beforeunload', function(e) {
            saveFormData();
        });
        
        // Thêm sự kiện lưu dữ liệu khi người dùng thay đổi thông tin
        document.querySelectorAll('input, select, textarea').forEach(element => {
            element.addEventListener('input', saveFormData);
            element.addEventListener('change', saveFormData);
        });
        
        // Khi tick/un-tick tiểu ban trong MD thì render lại câu hỏi tương ứng
        ['md_design','md_content','md_design_secondary','md_content_secondary'].forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener('change', () => {
                    // render lại cả hai vị trí ưu tiên/dự bị nếu cần
                    renderBanQuestions(document.getElementById('priority_position').value, 'priority');
                    renderBanQuestions(document.getElementById('secondary_position').value, 'secondary');
                    saveFormData();
                });
            }
        });

        // Update position names when they change
        document.getElementById('priority_position').addEventListener('change', updatePositionNames);
        document.getElementById('secondary_position').addEventListener('change', updatePositionNames);
        
        // Initialize the form
        updateProgressBar();
        updateSecondaryOptions();
        
        // Tải dữ liệu đã lưu khi trang được tải
        window.addEventListener('DOMContentLoaded', function() {
            updateSecondaryOptions();
            loadFormData();
            renderGeneralQuestions();
            
            // Nếu đã chọn phân ban từ trước, hiển thị câu hỏi
            const prioritySelect = document.getElementById('priority_position');
            if (prioritySelect.value) {
                updatePositionNames();
            }
        });
        
        // Add shake animation for error states
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
