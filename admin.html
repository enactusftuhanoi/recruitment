<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin | Enactus FTU Hanoi</title>
  <link rel="icon" href="assets/icon.png" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
  <style>
    :root {
      --primary: #1a73e8;
      --primary-dark: #0d62cb;
      --primary-light: #e8f0fe;
      --secondary: #f5f7fa;
      --accent: #ff6b6b;
      --success: #4caf50;
      --warning: #ff9800;
      --info: #17a2b8;
      --text: #202124;
      --text-light: #5f6368;
      --border: #dadce0;
      --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
    }

    body {
      background: #f5f7fa;
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }

    /* Header styles */
    .admin-header {
      background: white;
      padding: 15px 30px;
      box-shadow: var(--card-shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 50px;
      height: 50px;
      background: var(--primary);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
    }

    .logo-text {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
    }

    .admin-actions {
      display: flex;
      gap: 15px;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      border: none;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .btn-outline {
      background: white;
      color: var(--primary);
      border: 1px solid var(--primary);
    }

    .btn-outline:hover {
      background: var(--primary-light);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    /* Main container */
    .app-container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Dashboard stats */
    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-title {
      font-size: 16px;
      color: var(--text-light);
      margin-bottom: 10px;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
    }

    /* Filter section */
    .filter-section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--card-shadow);
    }

    .filter-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .filter-group {
      flex: 1;
      min-width: 200px;
    }

    .filter-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-light);
    }

    .filter-input {
      width: 100%;
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 15px;
    }

    /* Candidate table */
    .candidate-table-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--card-shadow);
      overflow-x: auto;
    }

    .candidate-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    .candidate-table th, 
    .candidate-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .candidate-table th {
      background: var(--primary-light);
      color: var(--primary);
      font-weight: 600;
      cursor: pointer;
      position: relative;
    }

    .candidate-table th.sort-asc::after {
      content: ' \25B2';
      font-size: 12px;
    }
    
    .candidate-table th.sort-desc::after {
      content: ' \25BC';
      font-size: 12px;
    }

    .candidate-table tr:hover {
      background: rgba(26, 115, 232, 0.03);
    }

    .badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }

    .badge-primary {
      background: var(--primary-light);
      color: var(--primary);
    }

    .badge-success {
      background: rgba(76, 175, 80, 0.15);
      color: var(--success);
    }

    .badge-warning {
      background: rgba(255, 152, 0, 0.15);
      color: var(--warning);
    }

    .badge-danger {
      background: rgba(255, 107, 107, 0.15);
      color: var(--accent);
    }

    .action-btn {
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: var(--transition);
    }

    .action-btn-sm {
      padding: 5px 10px;
      font-size: 13px;
    }

    .btn-view {
      background: var(--primary);
      color: white;
    }

    .btn-edit {
      background: var(--warning);
      color: white;
    }

    .btn-delete {
      background: var(--accent);
      color: white;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      overflow: auto;
    }

    .modal-content {
      background: white;
      margin: 5% auto;
      padding: 30px;
      border-radius: 12px;
      width: 80%;
      max-width: 800px;
      box-shadow: 0 5px 30px rgba(0,0,0,0.3);
      animation: modalFadeIn 0.3s;
    }

    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(-50px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border);
    }

    .modal-title {
      font-size: 24px;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .close-modal {
      font-size: 28px;
      cursor: pointer;
      color: var(--text-light);
    }

    .candidate-detail {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 30px;
    }

    .candidate-avatar {
      text-align: center;
    }

    .avatar-img {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary-light);
      margin-bottom: 20px;
      background-color: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ccc;
      font-size: 40px;
    }

    .candidate-status {
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: var(--card-shadow);
      margin-bottom: 20px;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .info-card {
      background: #f9fbfd;
      border-radius: 8px;
      padding: 15px;
      border-left: 3px solid var(--primary);
    }

    .info-label {
      font-size: 14px;
      color: var(--text-light);
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 16px;
      font-weight: 600;
    }

    /* Round details */
    .round-section {
      margin-top: 30px;
    }

    .round-title {
      font-size: 20px;
      color: var(--primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .round-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
    }

    .detail-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: var(--card-shadow);
    }

    .detail-title {
      font-size: 14px;
      color: var(--text-light);
      margin-bottom: 5px;
    }

    .detail-content {
      font-size: 16px;
      font-weight: 600;
    }

    /* Round management tabs */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 15px;
    }

    .tab-btn {
      padding: 10px 20px;
      border-radius: 6px;
      background: white;
      border: 1px solid var(--border);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
    }

    .tab-btn:hover, .tab-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.4s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Form elements */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-light);
    }

    .form-control {
      width: 100%;
      padding: 10px 15px;
      border-radius: 6px;
      border: 1px solid var(--border);
      font-size: 15px;
    }

    .form-control:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
    }

    /* Responsive */
    @media (max-width: 992px) {
      .candidate-detail {
        grid-template-columns: 1fr;
      }
      
      .info-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .dashboard-stats {
        grid-template-columns: 1fr 1fr;
      }
      
      .modal-content {
        width: 95%;
        padding: 20px;
      }
    }

    @media (max-width: 576px) {
      .dashboard-stats {
        grid-template-columns: 1fr;
      }
      
      .admin-header {
        flex-direction: column;
        gap: 15px;
      }
      
      .admin-actions {
        width: 100%;
        justify-content: space-between;
      }
      
      .tabs {
        flex-direction: column;
      }
      
      .tab-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Login Section -->
  <div id="loginBox">
    <div class="app-container" style="max-width: 500px; margin-top: 100px;">
      <div class="filter-section" style="text-align: center;">
        <div class="logo" style="justify-content: center; margin-bottom: 20px;">
          <div class="logo-icon">
            <i class="fas fa-lock"></i>
          </div>
          <div class="logo-text">ENACTUS ADMIN</div>
        </div>
        
        <h2 style="margin-bottom: 30px; color: var(--primary);">Đăng nhập quản trị</h2>
        
        <form id="loginForm">
          <div class="filter-group" style="margin-bottom: 20px;">
            <label class="filter-label">Email</label>
            <input type="email" id="loginEmail" class="filter-input" placeholder="Nhập email quản trị" required>
          </div>
          
          <div class="filter-group" style="margin-bottom: 30px;">
            <label class="filter-label">Mật khẩu</label>
            <input type="password" id="loginPassword" class="filter-input" placeholder="Nhập mật khẩu" required>
          </div>
          
          <button type="button" id="loginButton" class="btn btn-primary" style="width: 100%; padding: 12px;">
            <i class="fas fa-sign-in-alt"></i> Đăng nhập
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Admin Content (hidden until login) -->
  <div id="adminContent" style="display: none;">
    <!-- Header -->
    <div class="admin-header">
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="logo-text">ENACTUS FTU HANOI - QUẢN TRỊ</div>
      </div>
      <div class="admin-actions">
        <button id="refreshButton" class="btn btn-outline">
          <i class="fas fa-sync-alt"></i> Làm mới
        </button>
        <button id="exportButton" class="btn btn-success">
          <i class="fas fa-file-export"></i> Xuất CSV
        </button>
        <button id="logoutBtn" class="btn btn-primary">
          <i class="fas fa-sign-out-alt"></i> Đăng xuất
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="app-container">
      <h1 style="margin: 30px 0 20px; color: var(--text);">
        <i class="fas fa-users"></i> Quản lý ứng viên
      </h1>
      
      <!-- Dashboard Stats -->
      <div class="dashboard-stats">
        <div class="stat-card">
          <div class="stat-title">Tổng ứng viên</div>
          <div class="stat-value" id="totalCandidates">0</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-title">Đã hoàn thành</div>
          <div class="stat-value" id="completedCandidates">0</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-title">Đang trong quá trình</div>
          <div class="stat-value" id="inProgressCandidates">0</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-title">Chờ xử lý</div>
          <div class="stat-value" id="pendingCandidates">0</div>
        </div>
      </div>
      
      <!-- Filter Section -->
      <div class="filter-section">
        <h3 style="margin-bottom: 15px; color: var(--primary);">
          <i class="fas fa-filter"></i> Bộ lọc ứng viên
        </h3>
        
        <div class="filter-row">
          <div class="filter-group">
            <label class="filter-label">Tìm kiếm</label>
            <input type="text" id="searchInput" class="filter-input" placeholder="Tìm theo tên, email, SĐT...">
          </div>
          
          <div class="filter-group">
            <label class="filter-label">Ban ứng tuyển</label>
            <select id="departmentFilter" class="filter-input">
              <option value="">Tất cả ban</option>
              <option value="Nhân sự">Nhân sự</option>
              <option value="Truyền thông">Truyền thông</option>
              <option value="Đối ngoại">Đối ngoại</option>
              <option value="Dự án">Dự án</option>
              <option value="Sáng tạo">Sáng tạo</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label class="filter-label">Vòng hiện tại</label>
            <select id="roundFilter" class="filter-input">
              <option value="">Tất cả vòng</option>
              <option value="1">Vòng đơn</option>
              <option value="2">Phỏng vấn nhóm</option>
              <option value="3">Thử thách</option>
              <option value="4">Phỏng vấn cá nhân</option>
              <option value="5">Đã hoàn thành</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label class="filter-label">Trạng thái</label>
            <select id="statusFilter" class="filter-input">
              <option value="">Tất cả trạng thái</option>
              <option value="Chờ xử lý">Chờ xử lý</option>
              <option value="Đã duyệt">Đã duyệt</option>
              <option value="Từ chối">Từ chối</option>
            </select>
          </div>
        </div>
      </div>
      
      <!-- Candidate Table -->
      <div class="candidate-table-container">
        <table class="candidate-table">
          <thead>
            <tr>
              <th data-sort="fullname">Họ tên</th>
              <th data-sort="department">Ban ứng tuyển</th>
              <th data-sort="current_round">Vòng hiện tại</th>
              <th data-sort="email">Email</th>
              <th data-sort="phone">SĐT</th>
              <th data-sort="status">Trạng thái</th>
              <th>Hành động</th>
            </tr>
          </thead>
          <tbody id="candidateList">
            <!-- Candidate data will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- Candidate Detail Modal -->
  <div id="candidateModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">
          <i class="fas fa-user"></i> 
          <span id="modalCandidateName">Chi tiết ứng viên</span>
        </h2>
        <span class="close-modal">&times;</span>
      </div>
      
      <div class="candidate-detail">
        <div class="candidate-avatar">
          <div class="avatar-img" id="modalAvatar">
            <i class="fas fa-user"></i>
          </div>
          <button class="btn btn-primary" id="editCandidateBtn">
            <i class="fas fa-edit"></i> Chỉnh sửa
          </button>
        </div>
        
        <div>
          <div class="candidate-status">
            <div class="status-item">
              <span>Ban ứng tuyển:</span>
              <span class="badge badge-primary" id="modalDepartment">Nhân sự</span>
            </div>
            <div class="status-item">
              <span>Vòng hiện tại:</span>
              <span class="badge badge-success" id="modalCurrentRound">Vòng 1</span>
            </div>
            <div class="status-item">
              <span>Trạng thái:</span>
              <span class="badge badge-warning" id="modalStatus">Chờ xử lý</span>
            </div>
          </div>
          
          <div class="info-grid">
            <div class="info-card">
              <div class="info-label">Họ và tên</div>
              <div class="info-value" id="modalFullName">Nguyễn Văn A</div>
            </div>
            <div class="info-card">
              <div class="info-label">Giới tính</div>
              <div class="info-value" id="modalGender">Nam</div>
            </div>
            <div class="info-card">
              <div class="info-label">Email</div>
              <div class="info-value" id="modalEmail">example@ftu.edu.vn</div>
            </div>
            <div class="info-card">
              <div class="info-label">Số điện thoại</div>
              <div class="info-value" id="modalPhone">0123456789</div>
            </div>
            <div class="info-card">
              <div class="info-label">Ngày sinh</div>
              <div class="info-value" id="modalDob">01/01/2000</div>
            </div>
            <div class="info-card">
              <div class="info-label">Trường</div>
              <div class="info-value" id="modalSchool">FTU Hanoi</div>
            </div>
            <div class="info-card">
              <div class="info-label">Khoa/Ngành</div>
              <div class="info-value" id="modalFaculty">Kinh tế quốc tế</div>
            </div>
            <div class="info-card">
              <div class="info-label">MSSV</div>
              <div class="info-value" id="modalStudentId">20201234</div>
            </div>
          </div>
          
          <!-- Round Management Tabs -->
          <div class="round-section">
            <div class="tabs">
              <button class="tab-btn active" data-tab="round1">Vòng đơn</button>
              <button class="tab-btn" data-tab="round2">Phỏng vấn nhóm</button>
              <button class="tab-btn" data-tab="round3">Thử thách</button>
              <button class="tab-btn" data-tab="round4">Phỏng vấn cá nhân</button>
            </div>
            
            <!-- Round 1 Content -->
            <div id="round1" class="tab-content active">
              <div class="form-group">
                <label class="form-label">Trạng thái</label>
                <select class="form-control" id="round1StatusSelect">
                  <option value="Chưa bắt đầu">Chưa bắt đầu</option>
                  <option value="Đã nộp">Đã nộp</option>
                  <option value="Đã duyệt">Đã duyệt</option>
                  <option value="Từ chối">Từ chối</option>
                </select>
              </div>
              <button class="btn btn-primary" id="saveRound1Btn">
                <i class="fas fa-save"></i> Lưu thông tin
              </button>
            </div>
            
            <!-- Round 2 Content -->
            <div id="round2" class="tab-content">
              <div class="form-group">
                <label class="form-label">Trạng thái</label>
                <select class="form-control" id="round2StatusSelect">
                  <option value="Chưa bắt đầu">Chưa bắt đầu</option>
                  <option value="Đang chờ">Đang chờ</option>
                  <option value="Đã hoàn thành">Đã hoàn thành</option>
                  <option value="Đã duyệt">Đã duyệt</option>
                  <option value="Từ chối">Từ chối</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">Thời gian</label>
                <input type="text" class="form-control" id="round2Time" placeholder="VD: 14:00 - 16:00, Thứ 7 ngày 15/07">
              </div>
              
              <div class="form-group">
                <label class="form-label">Địa điểm</label>
                <input type="text" class="form-control" id="round2Location" placeholder="Nhập địa điểm">
              </div>
              
              <div class="form-group">
                <label class="form-label">Thành viên nhóm</label>
                <input type="text" class="form-control" id="round2Members" placeholder="Nhập tên thành viên, cách nhau bằng dấu phẩy">
              </div>
              
              <div class="form-group">
                <label class="form-label">Ghi chú</label>
                <textarea class="form-control" id="round2Note" rows="3" placeholder="Nhập ghi chú"></textarea>
              </div>
              
              <button class="btn btn-primary" id="saveRound2Btn">
                <i class="fas fa-save"></i> Lưu thông tin
              </button>
            </div>
            
            <!-- Round 3 Content -->
            <div id="round3" class="tab-content">
              <div class="form-group">
                <label class="form-label">Trạng thái</label>
                <select class="form-control" id="round3StatusSelect">
                  <option value="Chưa bắt đầu">Chưa bắt đầu</option>
                  <option value="Đang thực hiện">Đang thực hiện</option>
                  <option value="Đã nộp bài">Đã nộp bài</option>
                  <option value="Đã duyệt">Đã duyệt</option>
                  <option value="Từ chối">Từ chối</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">Đề bài</label>
                <textarea class="form-control" id="round3Challenge" rows="3" placeholder="Nhập đề bài thử thách"></textarea>
              </div>
              
              <div class="form-group">
                <label class="form-label">Tài liệu hướng dẫn</label>
                <input type="text" class="form-control" id="round3Materials" placeholder="Link tài liệu">
              </div>
              
              <div class="form-group">
                <label class="form-label">Hạn nộp bài</label>
                <input type="text" class="form-control" id="round3Deadline" placeholder="DD/MM/YYYY HH:MM">
              </div>
              
              <div class="form-group">
                <label class="form-label">Thông tin pitching</label>
                <input type="text" class="form-control" id="round3Pitching" placeholder="Thời gian và địa điểm">
              </div>
              
              <div class="form-group">
                <label class="form-label">Advisor</label>
                <input type="text" class="form-control" id="round3Advisor" placeholder="Tên advisor">
              </div>
              
              <button class="btn btn-primary" id="saveRound3Btn">
                <i class="fas fa-save"></i> Lưu thông tin
              </button>
            </div>
            
            <!-- Round 4 Content -->
            <div id="round4" class="tab-content">
              <div class="form-group">
                <label class="form-label">Trạng thái</label>
                <select class="form-control" id="round4StatusSelect">
                  <option value="Chưa bắt đầu">Chưa bắt đầu</option>
                  <option value="Đang chờ">Đang chờ</option>
                  <option value="Đã hoàn thành">Đã hoàn thành</option>
                  <option value="Đã duyệt">Đã duyệt</option>
                  <option value="Từ chối">Từ chối</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">Thời gian</label>
                <input type="text" class="form-control" id="round4Time" placeholder="VD: 14:00 - 15:00, Thứ 3 ngày 20/07">
              </div>
              
              <div class="form-group">
                <label class="form-label">Địa điểm</label>
                <input type="text" class="form-control" id="round4Location" placeholder="Nhập địa điểm">
              </div>
              
              <div class="form-group">
                <label class="form-label">Người phỏng vấn</label>
                <input type="text" class="form-control" id="round4Interviewer" placeholder="Nhập tên người phỏng vấn">
              </div>
              
              <div class="form-group">
                <label class="form-label">Ghi chú</label>
                <textarea class="form-control" id="round4Note" rows="3" placeholder="Nhập ghi chú"></textarea>
              </div>
              
              <button class="btn btn-primary" id="saveRound4Btn">
                <i class="fas fa-save"></i> Lưu thông tin
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Candidate Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">
          <i class="fas fa-edit"></i> 
          <span id="editModalTitle">Chỉnh sửa thông tin ứng viên</span>
        </h2>
        <span class="close-modal">&times;</span>
      </div>
      
      <div class="form-group">
        <label class="form-label">Họ và tên</label>
        <input type="text" class="form-control" id="editFullName">
      </div>
      
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-control" id="editEmail">
      </div>
      
      <div class="form-group">
        <label class="form-label">Số điện thoại</label>
        <input type="tel" class="form-control" id="editPhone">
      </div>
      
      <div class="form-group">
        <label class="form-label">Ban ứng tuyển</label>
        <select class="form-control" id="editDepartment">
          <option value="Nhân sự">Nhân sự</option>
          <option value="Truyền thông">Truyền thông</option>
          <option value="Đối ngoại">Đối ngoại</option>
          <option value="Dự án">Dự án</option>
          <option value="Sáng tạo">Sáng tạo</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Vòng hiện tại</label>
        <select class="form-control" id="editCurrentRound">
          <option value="1">Vòng 1: Vòng đơn</option>
          <option value="2">Vòng 2: Phỏng vấn nhóm</option>
          <option value="3">Vòng 3: Thử thách</option>
          <option value="4">Vòng 4: Phỏng vấn cá nhân</option>
          <option value="5">Hoàn thành</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Trạng thái</label>
        <select class="form-control" id="editStatus">
          <option value="Chờ xử lý">Chờ xử lý</option>
          <option value="Đã duyệt">Đã duyệt</option>
          <option value="Từ chối">Từ chối</option>
        </select>
      </div>
      
      <button class="btn btn-primary" id="saveEditBtn" style="width: 100%; padding: 12px; margin-top: 20px;">
        <i class="fas fa-save"></i> Lưu thay đổi
      </button>
    </div>
  </div>

  <!-- Firebase and other scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      signOut, 
      onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { 
      getFirestore, 
      collection, 
      getDocs, 
      doc, 
      updateDoc 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDuTvBn8Xl01DYddVXQ7M0L24K3l-GyG0c",
      authDomain: "enactusftuhanoi-tracuu.firebaseapp.com",
      projectId: "enactusftuhanoi-tracuu",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Toastr configuration
    toastr.options = {
      closeButton: true,
      progressBar: true,
      positionClass: 'toast-bottom-right',
      timeOut: 3000
    };

    // DOM elements
    const loginBox = document.getElementById('loginBox');
    const adminContent = document.getElementById('adminContent');
    const loginForm = document.getElementById('loginForm');
    const loginButton = document.getElementById('loginButton');
    const logoutBtn = document.getElementById('logoutBtn');
    const refreshButton = document.getElementById('refreshButton');
    const exportButton = document.getElementById('exportButton');
    const candidateList = document.getElementById('candidateList');
    const searchInput = document.getElementById('searchInput');
    const departmentFilter = document.getElementById('departmentFilter');
    const roundFilter = document.getElementById('roundFilter');
    const statusFilter = document.getElementById('statusFilter');
    
    // Modal elements
    const candidateModal = document.getElementById('candidateModal');
    const editModal = document.getElementById('editModal');
    const closeModalButtons = document.querySelectorAll('.close-modal');
    
    // Stats elements
    const totalCandidates = document.getElementById('totalCandidates');
    const completedCandidates = document.getElementById('completedCandidates');
    const inProgressCandidates = document.getElementById('inProgressCandidates');
    const pendingCandidates = document.getElementById('pendingCandidates');
    
    // Tab management
    const tabButtons = document.querySelectorAll('.tab-btn');
    
    // Current selected candidate
    let currentCandidateId = null;
    let candidatesData = [];
    let filteredCandidates = [];
    let currentSortField = null;
    let currentSortDirection = 'asc';

    // Login function
    async function login() {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      if (!email || !password) {
        toastr.warning('Vui lòng nhập email và mật khẩu');
        return;
      }
      
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        loginBox.style.display = 'none';
        adminContent.style.display = 'block';
        loadCandidates();
        toastr.success('Đăng nhập thành công');
      } catch (error) {
        console.error('Login error:', error);
        toastr.error('Đăng nhập thất bại. Vui lòng kiểm tra lại thông tin');
      }
    }

    // Logout function
    async function logout() {
      try {
        await signOut(auth);
        adminContent.style.display = 'none';
        loginBox.style.display = 'block';
        loginForm.reset();
        toastr.info('Bạn đã đăng xuất');
      } catch (error) {
        console.error('Logout error:', error);
        toastr.error('Đăng xuất thất bại');
      }
    }

    // Load candidates from Firestore
    async function loadCandidates() {
      try {
        const snapshot = await getDocs(collection(db, "users"));
        candidatesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        filteredCandidates = [...candidatesData];
        
        updateStats();
        renderCandidates();
      } catch (error) {
        console.error('Error loading candidates:', error);
        toastr.error('Không thể tải danh sách ứng viên');
      }
    }

    // Update dashboard stats
    function updateStats() {
      totalCandidates.textContent = candidatesData.length;
      
      const completed = candidatesData.filter(c => c.current_round > 4).length;
      completedCandidates.textContent = completed;
      
      const inProgress = candidatesData.filter(c => c.current_round > 0 && c.current_round <= 4).length;
      inProgressCandidates.textContent = inProgress;
      
      const pending = candidatesData.filter(c => c.status === 'Chờ xử lý').length;
      pendingCandidates.textContent = pending;
    }

    // Render candidates table
    function renderCandidates() {
      candidateList.innerHTML = filteredCandidates.map(candidate => `
        <tr>
          <td>${candidate.fullname || 'Chưa cập nhật'}</td>
          <td>
            <span class="badge badge-primary">${candidate.department || 'Chưa chọn'}</span>
          </td>
          <td>
            ${getRoundBadge(candidate.current_round)}
          </td>
          <td>${candidate.email || 'Chưa cập nhật'}</td>
          <td>${candidate.phone || 'Chưa cập nhật'}</td>
          <td>
            ${getStatusBadge(candidate.status)}
          </td>
          <td>
            <button class="action-btn btn-view" data-id="${candidate.id}">
              <i class="fas fa-eye"></i> Xem
            </button>
            <button class="action-btn btn-edit action-btn-sm" data-id="${candidate.id}">
              <i class="fas fa-edit"></i>
            </button>
          </td>
        </tr>
      `).join('');
      
      // Add event listeners to view buttons
      document.querySelectorAll('.btn-view').forEach(btn => {
        btn.addEventListener('click', function() {
          const candidateId = this.getAttribute('data-id');
          showCandidateDetail(candidateId);
        });
      });
      
      // Add event listeners to edit buttons
      document.querySelectorAll('.btn-edit').forEach(btn => {
        btn.addEventListener('click', function() {
          const candidateId = this.getAttribute('data-id');
          showEditModal(candidateId);
        });
      });
    }

    // Get round badge HTML
    function getRoundBadge(round) {
      if (!round) return '<span class="badge badge-warning">Chưa bắt đầu</span>';
      
      const rounds = [
        'Vòng đơn',
        'Phỏng vấn nhóm',
        'Thử thách',
        'Phỏng vấn cá nhân',
        'Hoàn thành'
      ];
      
      if (round <= 4) {
        return `<span class="badge badge-primary">Vòng ${round}: ${rounds[round-1]}</span>`;
      } else {
        return `<span class="badge badge-success">${rounds[4]}</span>`;
      }
    }

    // Get status badge HTML
    function getStatusBadge(status) {
      if (!status) return '<span class="badge badge-warning">Chưa xác định</span>';
      
      switch(status) {
        case 'Đã duyệt':
          return '<span class="badge badge-success">Đã duyệt</span>';
        case 'Từ chối':
          return '<span class="badge badge-danger">Từ chối</span>';
        default:
          return '<span class="badge badge-warning">Chờ xử lý</span>';
      }
    }

    // Show candidate detail modal
    function showCandidateDetail(candidateId) {
      const candidate = candidatesData.find(c => c.id === candidateId);
      if (!candidate) return;
      
      currentCandidateId = candidateId;
      
      // Update modal content
      document.getElementById('modalCandidateName').textContent = candidate.fullname || 'Ứng viên';
      document.getElementById('modalDepartment').textContent = candidate.department || 'Chưa chọn';
      document.getElementById('modalCurrentRound').textContent = getRoundText(candidate.current_round);
      document.getElementById('modalStatus').textContent = candidate.status || 'Chưa xác định';
      
      // Personal info
      document.getElementById('modalFullName').textContent = candidate.fullname || 'Chưa cập nhật';
      document.getElementById('modalGender').textContent = candidate.gender || 'Chưa cập nhật';
      document.getElementById('modalEmail').textContent = candidate.email || 'Chưa cập nhật';
      document.getElementById('modalPhone').textContent = candidate.phone || 'Chưa cập nhật';
      document.getElementById('modalDob').textContent = candidate.dob || 'Chưa cập nhật';
      document.getElementById('modalSchool').textContent = candidate.school || 'Chưa cập nhật';
      document.getElementById('modalFaculty').textContent = candidate.faculty || 'Chưa cập nhật';
      document.getElementById('modalStudentId').textContent = candidate.studentId || 'Chưa cập nhật';
      
      // Load round data
      loadRoundData(candidate);
      
      // Show modal
      candidateModal.style.display = 'block';
    }

    // Load round data into modal
    function loadRoundData(candidate) {
      // Round 1
      document.getElementById('round1StatusSelect').value = candidate.round_1?.status || 'Chưa bắt đầu';
      
      // Round 2
      document.getElementById('round2StatusSelect').value = candidate.round_2?.status || 'Chưa bắt đầu';
      document.getElementById('round2Time').value = candidate.round_2?.time || '';
      document.getElementById('round2Location').value = candidate.round_2?.location || '';
      document.getElementById('round2Members').value = candidate.round_2?.members || '';
      document.getElementById('round2Note').value = candidate.round_2?.note || '';
      
      // Round 3
      document.getElementById('round3StatusSelect').value = candidate.round_3?.status || 'Chưa bắt đầu';
      document.getElementById('round3Challenge').value = candidate.round_3?.challenge || '';
      document.getElementById('round3Materials').value = candidate.round_3?.materials || '';
      document.getElementById('round3Deadline').value = candidate.round_3?.deadline || '';
      document.getElementById('round3Pitching').value = candidate.round_3?.pitching || '';
      document.getElementById('round3Advisor').value = candidate.round_3?.advisor || '';
      
      // Round 4
      document.getElementById('round4StatusSelect').value = candidate.round_4?.status || 'Chưa bắt đầu';
      document.getElementById('round4Time').value = candidate.round_4?.time || '';
      document.getElementById('round4Location').value = candidate.round_4?.location || '';
      document.getElementById('round4Interviewer').value = candidate.round_4?.interviewer || '';
      document.getElementById('round4Note').value = candidate.round_4?.note || '';
    }

    // Get round text
    function getRoundText(round) {
      if (!round) return 'Chưa bắt đầu';
      
      const rounds = [
        'Vòng đơn',
        'Phỏng vấn nhóm',
        'Thử thách',
        'Phỏng vấn cá nhân',
        'Hoàn thành'
      ];
      
      if (round <= 4) {
        return `Vòng ${round}: ${rounds[round-1]}`;
      } else {
        return rounds[4];
      }
    }

    // Show edit modal
    function showEditModal(candidateId) {
      const candidate = candidatesData.find(c => c.id === candidateId);
      if (!candidate) return;
      
      currentCandidateId = candidateId;
      
      // Fill form with candidate data
      document.getElementById('editFullName').value = candidate.fullname || '';
      document.getElementById('editEmail').value = candidate.email || '';
      document.getElementById('editPhone').value = candidate.phone || '';
      document.getElementById('editDepartment').value = candidate.department || 'Nhân sự';
      document.getElementById('editCurrentRound').value = candidate.current_round || '1';
      document.getElementById('editStatus').value = candidate.status || 'Chờ xử lý';
      
      // Show modal
      editModal.style.display = 'block';
    }

    // Save edited candidate
    async function saveEditedCandidate() {
      if (!currentCandidateId) return;
      
      try {
        const candidateRef = doc(db, "users", currentCandidateId);
        
        await updateDoc(candidateRef, {
          fullname: document.getElementById('editFullName').value,
          email: document.getElementById('editEmail').value,
          phone: document.getElementById('editPhone').value,
          department: document.getElementById('editDepartment').value,
          current_round: parseInt(document.getElementById('editCurrentRound').value),
          status: document.getElementById('editStatus').value,
          updatedAt: new Date()
        });
        
        // Update local data
        const candidateIndex = candidatesData.findIndex(c => c.id === currentCandidateId);
        if (candidateIndex !== -1) {
          candidatesData[candidateIndex] = {
            ...candidatesData[candidateIndex],
            fullname: document.getElementById('editFullName').value,
            email: document.getElementById('editEmail').value,
            phone: document.getElementById('editPhone').value,
            department: document.getElementById('editDepartment').value,
            current_round: parseInt(document.getElementById('editCurrentRound').value),
            status: document.getElementById('editStatus').value
          };
        }
        
        // Update filtered data
        const filteredIndex = filteredCandidates.findIndex(c => c.id === currentCandidateId);
        if (filteredIndex !== -1) {
          filteredCandidates[filteredIndex] = {
            ...filteredCandidates[filteredIndex],
            fullname: document.getElementById('editFullName').value,
            email: document.getElementById('editEmail').value,
            phone: document.getElementById('editPhone').value,
            department: document.getElementById('editDepartment').value,
            current_round: parseInt(document.getElementById('editCurrentRound').value),
            status: document.getElementById('editStatus').value
          };
        }
        
        // Update UI
        renderCandidates();
        updateStats();
        
        // Close modal
        editModal.style.display = 'none';
        
        toastr.success('Cập nhật thông tin ứng viên thành công');
      } catch (error) {
        console.error('Error updating candidate:', error);
        toastr.error('Cập nhật thông tin thất bại');
      }
    }

    // Save round data
    async function saveRoundData(roundNumber) {
      if (!currentCandidateId) return;
      
      try {
        const candidateRef = doc(db, "users", currentCandidateId);
        const roundData = {};
        const roundField = `round_${roundNumber}`;
        
        // Get data based on round number
        switch(roundNumber) {
          case 1:
            roundData.status = document.getElementById('round1StatusSelect').value;
            break;
          case 2:
            roundData.status = document.getElementById('round2StatusSelect').value;
            roundData.time = document.getElementById('round2Time').value;
            roundData.location = document.getElementById('round2Location').value;
            roundData.members = document.getElementById('round2Members').value;
            roundData.note = document.getElementById('round2Note').value;
            break;
          case 3:
            roundData.status = document.getElementById('round3StatusSelect').value;
            roundData.challenge = document.getElementById('round3Challenge').value;
            roundData.materials = document.getElementById('round3Materials').value;
            roundData.deadline = document.getElementById('round3Deadline').value;
            roundData.pitching = document.getElementById('round3Pitching').value;
            roundData.advisor = document.getElementById('round3Advisor').value;
            break;
          case 4:
            roundData.status = document.getElementById('round4StatusSelect').value;
            roundData.time = document.getElementById('round4Time').value;
            roundData.location = document.getElementById('round4Location').value;
            roundData.interviewer = document.getElementById('round4Interviewer').value;
            roundData.note = document.getElementById('round4Note').value;
            break;
        }
        
        await updateDoc(candidateRef, {
          [roundField]: roundData,
          updatedAt: new Date()
        });
        
        // Update local data
        const candidateIndex = candidatesData.findIndex(c => c.id === currentCandidateId);
        if (candidateIndex !== -1) {
          candidatesData[candidateIndex][roundField] = roundData;
        }
        
        // Update filtered data
        const filteredIndex = filteredCandidates.findIndex(c => c.id === currentCandidateId);
        if (filteredIndex !== -1) {
          filteredCandidates[filteredIndex][roundField] = roundData;
        }
        
        toastr.success(`Cập nhật thông tin vòng ${roundNumber} thành công`);
      } catch (error) {
        console.error(`Error updating round ${roundNumber}:`, error);
        toastr.error(`Cập nhật thông tin vòng ${roundNumber} thất bại`);
      }
    }

    // Filter candidates
    function filterCandidates() {
      const searchTerm = searchInput.value.toLowerCase();
      const department = departmentFilter.value;
      const round = roundFilter.value;
      const status = statusFilter.value;
      
      filteredCandidates = candidatesData.filter(candidate => {
        // Search filter
        const nameMatch = candidate.fullname?.toLowerCase().includes(searchTerm) || false;
        const emailMatch = candidate.email?.toLowerCase().includes(searchTerm) || false;
        const phoneMatch = candidate.phone?.includes(searchTerm) || false;
        
        // Other filters
        const departmentMatch = department ? candidate.department === department : true;
        const roundMatch = round ? 
          (round === '5' ? candidate.current_round > 4 : candidate.current_round == round) : true;
        const statusMatch = status ? candidate.status === status : true;
        
        return (nameMatch || emailMatch || phoneMatch) && 
               departmentMatch && 
               roundMatch && 
               statusMatch;
      });
      
      renderCandidates();
    }

    // Sort candidates
    function sortCandidates(field) {
      if (currentSortField === field) {
        currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        currentSortField = field;
        currentSortDirection = 'asc';
      }
      
      // Remove all sort indicators
      document.querySelectorAll('th[data-sort]').forEach(th => {
        th.classList.remove('sort-asc', 'sort-desc');
      });
      
      // Add sort indicator to current column
      const header = document.querySelector(`th[data-sort="${field}"]`);
      if (header) {
        header.classList.add(`sort-${currentSortDirection}`);
      }
      
      filteredCandidates.sort((a, b) => {
        let valueA = a[field] || '';
        let valueB = b[field] || '';
        
        if (field === 'current_round') {
          return currentSortDirection === 'asc' ? 
            valueA - valueB : valueB - valueA;
        }
        
        if (valueA < valueB) return currentSortDirection === 'asc' ? -1 : 1;
        if (valueA > valueB) return currentSortDirection === 'asc' ? 1 : -1;
        return 0;
      });
      
      renderCandidates();
    }

    // Export to CSV
    function exportToCSV() {
      if (filteredCandidates.length === 0) {
        toastr.warning('Không có dữ liệu để xuất');
        return;
      }
      
      let csvContent = "Họ tên,Ban,Vòng hiện tại,Email,SĐT,Trạng thái\n";
      
      filteredCandidates.forEach(candidate => {
        const round = getRoundText(candidate.current_round);
        csvContent += `"${candidate.fullname || ''}","${candidate.department || ''}","${round}","${candidate.email || ''}","${candidate.phone || ''}","${candidate.status || ''}"\n`;
      });
      
      const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', 'danh_sach_ung_vien.csv');
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      toastr.success('Xuất file CSV thành công');
    }

    // Initialize event listeners
    function initEventListeners() {
      // Login button
      loginButton.addEventListener('click', login);
      
      // Logout button
      logoutBtn.addEventListener('click', logout);
      
      // Refresh button
      refreshButton.addEventListener('click', loadCandidates);
      
      // Export button
      exportButton.addEventListener('click', exportToCSV);
      
      // Filter inputs
      searchInput.addEventListener('input', filterCandidates);
      departmentFilter.addEventListener('change', filterCandidates);
      roundFilter.addEventListener('change', filterCandidates);
      statusFilter.addEventListener('change', filterCandidates);
      
      // Table sorting
      document.querySelectorAll('th[data-sort]').forEach(th => {
        th.addEventListener('click', function() {
          sortCandidates(this.getAttribute('data-sort'));
        });
      });
      
      // Modal close buttons
      closeModalButtons.forEach(btn => {
        btn.addEventListener('click', function() {
          candidateModal.style.display = 'none';
          editModal.style.display = 'none';
        });
      });
      
      // Close modal when clicking outside
      window.addEventListener('click', function(event) {
        if (event.target === candidateModal) {
          candidateModal.style.display = 'none';
        }
        if (event.target === editModal) {
          editModal.style.display = 'none';
        }
      });
      
      // Tab switching
      tabButtons.forEach(btn => {
        btn.addEventListener('click', function() {
          const tabId = this.getAttribute('data-tab');
          
          // Update active tab button
          tabButtons.forEach(tab => tab.classList.remove('active'));
          this.classList.add('active');
          
          // Update active tab content
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
          });
          document.getElementById(tabId).classList.add('active');
        });
      });
      
      // Save buttons
      document.getElementById('saveEditBtn').addEventListener('click', saveEditedCandidate);
      document.getElementById('saveRound1Btn').addEventListener('click', () => saveRoundData(1));
      document.getElementById('saveRound2Btn').addEventListener('click', () => saveRoundData(2));
      document.getElementById('saveRound3Btn').addEventListener('click', () => saveRoundData(3));
      document.getElementById('saveRound4Btn').addEventListener('click', () => saveRoundData(4));
    }

    // Check auth state
    onAuthStateChanged(auth, (user) => {
      if (user) {
        loginBox.style.display = 'none';
        adminContent.style.display = 'block';
        loadCandidates();
      } else {
        loginBox.style.display = 'block';
        adminContent.style.display = 'none';
      }
    });

    // Initialize the app
    document.addEventListener('DOMContentLoaded', function() {
      initEventListeners();
    });
  </script>
</body>
</html>