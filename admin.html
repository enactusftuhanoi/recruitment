<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin | Enactus FTU Hanoi</title>
  <link rel="icon" href="/assets/icon.png" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #1a73e8;
      --primary-dark: #0d62cb;
      --primary-light: #e8f0fe;
      --secondary: #f5f7fa;
      --accent: #ff6b6b;
      --success: #4caf50;
      --warning: #ff9800;
      --text: #202124;
      --text-light: #5f6368;
      --border: #dadce0;
      --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 0;
      line-height: 1.6;
    }

    .app-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      margin-bottom: 30px;
      border-bottom: 1px solid var(--border);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 50px;
      height: 50px;
      background: var(--primary);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }

    .logo-text {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
    }

    .admin-actions {
      display: flex;
      gap: 15px;
    }

    .action-btn {
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      border: none;
    }

    .logout-btn {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.25);
    }

    .logout-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(26, 115, 232, 0.35);
    }

    .refresh-btn {
      background: white;
      color: var(--primary);
      border: 1px solid var(--primary);
    }

    .refresh-btn:hover {
      background: var(--primary-light);
    }

    /* Page Title */
    .page-title {
      text-align: center;
      margin-bottom: 30px;
      color: var(--text);
      font-size: 32px;
      position: relative;
      padding-bottom: 15px;
    }

    .page-title:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: var(--primary);
      border-radius: 2px;
    }

    /* Login Box */
    #loginBox {
      max-width: 500px;
      margin: 100px auto;
      padding: 40px;
      background: white;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      text-align: center;
    }

    .login-title {
      font-size: 28px;
      color: var(--primary);
      margin-bottom: 30px;
    }

    .login-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .form-group {
      text-align: left;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-light);
    }

    .form-input {
      width: 100%;
      padding: 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 16px;
      transition: var(--transition);
    }

    .form-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
      outline: none;
    }

    .login-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 14px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 10px;
    }

    .login-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(26, 115, 232, 0.35);
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 15px;
    }

    .tab-btn {
      padding: 12px 25px;
      border-radius: 8px;
      background: white;
      border: 1px solid var(--border);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
    }

    .tab-btn:hover, .tab-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .tab-content {
      display: none;
      padding: 25px;
      background: white;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      margin-bottom: 30px;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    /* Tables */
    .user-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    .user-table th, .user-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .user-table th {
      background: var(--primary-light);
      color: var(--primary);
      font-weight: 600;
    }

    .user-table tr:hover {
      background: rgba(26, 115, 232, 0.03);
    }

    .action-btn-small {
      padding: 8px 15px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: var(--transition);
    }

    .action-btn-small:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    /* Form elements */
    .select-box {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 16px;
      margin-top: 8px;
      margin-bottom: 20px;
      transition: var(--transition);
    }

    .select-box:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
      outline: none;
    }

    .input-box {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 16px;
      margin-top: 8px;
      margin-bottom: 15px;
      transition: var(--transition);
    }

    .input-box:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
      outline: none;
    }

    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-col {
      flex: 1;
    }

    .save-btn {
      background: var(--success);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
    }

    .save-btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    /* Round Details */
    .round-box {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      background: var(--primary-light);
    }

    .round-title {
      font-size: 18px;
      color: var(--primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Profile Preview */
    .preview-box {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      border: 1px solid var(--border);
      box-shadow: var(--card-shadow);
    }
    
    .preview-title {
      color: var(--primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .preview-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .preview-section {
      background: #f9fbfd;
      border-radius: 8px;
      padding: 15px;
      border-left: 3px solid var(--primary);
    }
    
    .preview-label {
      font-size: 14px;
      color: var(--text-light);
      margin-bottom: 5px;
    }
    
    .preview-value {
      font-size: 16px;
      font-weight: 600;
    }

    /* Footer */
    .admin-footer {
      text-align: center;
      padding: 30px 0;
      color: var(--text-light);
      font-size: 14px;
      margin-top: 40px;
      border-top: 1px solid var(--border);
    }

    /* Animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Responsive Design */
    @media (max-width: 900px) {
      .admin-header {
        flex-direction: column;
        gap: 20px;
      }
      
      .form-row {
        flex-direction: column;
        gap: 10px;
      }
      
      .preview-content {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .tabs {
        flex-direction: column;
      }
      
      .tab-btn {
        width: 100%;
      }
      
      .user-table {
        display: block;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>
  <!-- üîê Khu v·ª±c ƒëƒÉng nh·∫≠p -->
  <div id="loginBox">
    <div class="login-title">
      <i class="fas fa-lock"></i> ƒêƒÉng nh·∫≠p qu·∫£n tr·ªã
    </div>
    <form class="login-form" id="loginForm">
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" id="loginEmail" class="form-input" placeholder="Nh·∫≠p email qu·∫£n tr·ªã" required>
      </div>
      <div class="form-group">
        <label class="form-label">M·∫≠t kh·∫©u</label>
        <input type="password" id="loginPassword" class="form-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
      </div>
      <button type="button" class="login-btn" onclick="login()">
        <i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p
      </button>
    </form>
  </div>

  <!-- üìã N·ªôi dung qu·∫£n tr·ªã (·∫©n khi ch∆∞a ƒëƒÉng nh·∫≠p) -->
  <div id="adminContent" style="display: none;">
    <div class="app-container">
      <div class="admin-header">
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="logo-text">ENACTUS FTU HANOI - QU·∫¢N TR·ªä</div>
        </div>
        <div class="admin-actions">
          <button class="action-btn refresh-btn" onclick="loadUsers()">
            <i class="fas fa-sync-alt"></i>
            L√†m m·ªõi
          </button>
          <button id="logoutBtn" class="action-btn logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            ƒêƒÉng xu·∫•t
          </button>
        </div>
      </div>

      <h1 class="page-title">üìã Qu·∫£n l√Ω ·ª©ng vi√™n</h1>
      
      <div class="tabs">
        <button class="tab-btn active" onclick="showTab('usersTab')">üë§ Danh s√°ch ·ª©ng vi√™n</button>
        <button class="tab-btn" onclick="showTab('roundsTab')">üîÑ Tr·∫°ng th√°i v√≤ng</button>
        <button class="tab-btn" onclick="showTab('detailTab')">üìù Chi ti·∫øt v√≤ng</button>
      </div>

      <!-- Danh s√°ch th√≠ sinh -->
      <section id="usersTab" class="tab-content active">
        <h2><i class="fas fa-users"></i> Danh s√°ch ·ª©ng vi√™n</h2>
        <table class="user-table">
          <thead>
            <tr>
              <th>H·ªç t√™n</th>
              <th>Email</th>
              <th>V√≤ng hi·ªán t·∫°i</th>
              <th>Tr·∫°ng th√°i</th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody id="userList"></tbody>
        </table>
      </section>

      <!-- Tr·∫°ng th√°i v√≤ng -->
      <section id="roundsTab" class="tab-content">
        <h2><i class="fas fa-tasks"></i> Tr·∫°ng th√°i c√°c v√≤ng</h2>
        <div class="form-group">
          <label class="form-label">Ch·ªçn ·ª©ng vi√™n</label>
          <select id="selectedUserIdRounds" class="select-box" onchange="renderSelectedRoundUser()">
            <option value="">-- Ch·ªçn ·ª©ng vi√™n --</option>
          </select>
        </div>
        <div id="roundsContainer"></div>
        
        <!-- Xem tr∆∞·ªõc profile -->
        <div id="profilePreview" class="preview-box">
          <h3 class="preview-title"><i class="fas fa-eye"></i> Xem tr∆∞·ªõc tr√™n Profile</h3>
          <div class="preview-content">
            <div class="preview-section">
              <div class="preview-label">Tr·∫°ng th√°i v√≤ng:</div>
              <div id="previewStatus" class="preview-value">ƒêang t·∫£i...</div>
            </div>
            <div class="preview-section">
              <div class="preview-label">Chi ti·∫øt v√≤ng hi·ªán t·∫°i:</div>
              <div id="previewRound" class="preview-value">ƒêang t·∫£i...</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Chi ti·∫øt v√≤ng -->
      <section id="detailTab" class="tab-content">
        <h2><i class="fas fa-info-circle"></i> Chi ti·∫øt t·ª´ng v√≤ng</h2>
        <div class="form-group">
          <label class="form-label">Ch·ªçn ·ª©ng vi√™n</label>
          <select id="selectedUserIdDetails" class="select-box" onchange="renderSelectedDetailUser()">
            <option value="">-- Ch·ªçn ·ª©ng vi√™n --</option>
          </select>
        </div>
        <div id="roundDetailContainer"></div>
      </section>
      
      <div class="admin-footer">
        <p>¬© 2025 Recruitment | Enactus FTU Hanoi</p>
        <p>Li√™n h·ªá: tuhm@vief.edu.vn | Phone: 0362977206</p>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore, collection, getDocs, doc, updateDoc, onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDuTvBn8Xl01DYddVXQ7M0L24K3l-GyG0c",
      authDomain: "enactusftuhanoi-tracuu.firebaseapp.com",
      projectId: "enactusftuhanoi-tracuu",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const userList = document.getElementById("userList");
    const roundsContainer = document.getElementById("roundsContainer");
    const roundDetailContainer = document.getElementById("roundDetailContainer");
    const previewStatus = document.getElementById("previewStatus");
    const previewRound = document.getElementById("previewRound");

    const steps = [
      "V√≤ng ƒë∆°n", "Ph·ªèng v·∫•n nh√≥m", "Th·ª≠ th√°ch", "Ph·ªèng v·∫•n c√° nh√¢n"
    ];

    let usersData = [];
    let currentSelectedUser = null;

    // K·∫øt n·ªëi v·ªõi profile: H√†m n√†y gi·∫£ l·∫≠p c√°ch d·ªØ li·ªáu s·∫Ω hi·ªÉn th·ªã tr√™n profile
    function updateProfilePreview(user) {
      if (!user) {
        previewStatus.innerHTML = "Ch∆∞a ch·ªçn ·ª©ng vi√™n";
        previewRound.innerHTML = "Ch∆∞a ch·ªçn ·ª©ng vi√™n";
        return;
      }
      
      // C·∫≠p nh·∫≠t tr·∫°ng th√°i v√≤ng
      const currentRound = user.current_round || 1;
      const roundStatus = currentRound <= 4 ? 
        `V√≤ng ${currentRound}: ${steps[currentRound-1]}` : 
        "‚úÖ ƒê√£ ho√†n th√†nh t·∫•t c·∫£ v√≤ng";
      
      previewStatus.innerHTML = roundStatus;
      
      // C·∫≠p nh·∫≠t chi ti·∫øt v√≤ng hi·ªán t·∫°i
      const roundInfo = user[`round_${currentRound}`] || {};
      let roundDetails = "Ch∆∞a c√≥ th√¥ng tin";
      
      if (roundInfo.time || roundInfo.note) {
        roundDetails = `
          <div><strong>Th·ªùi gian:</strong> ${roundInfo.time || "Ch∆∞a c·∫≠p nh·∫≠t"}</div>
          <div><strong>Status:</strong> ${roundInfo.note || "Ch∆∞a c·∫≠p nh·∫≠t"}</div>
          <div><strong>Ghi ch√∫:</strong> ${roundInfo.note || "Kh√¥ng c√≥ ghi ch√∫"}</div>
        `;
      }
      
      previewRound.innerHTML = roundDetails;
    }

    async function loadUsers() {
      try {
        const snapshot = await getDocs(collection(db, "users"));
        usersData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        populateUserDropdown();
        renderUsers();
        
        // C·∫≠p nh·∫≠t preview n·∫øu ƒëang ch·ªçn user
        if (currentSelectedUser) {
          const user = usersData.find(u => u.id === currentSelectedUser);
          if (user) updateProfilePreview(user);
        }
      } catch (error) {
        console.error("L·ªói t·∫£i d·ªØ li·ªáu ng∆∞·ªùi d√πng:", error);
        alert("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu ng∆∞·ªùi d√πng. Vui l√≤ng th·ª≠ l·∫°i.");
      }
    }

    function populateUserDropdown() {
      const selectRounds = document.getElementById("selectedUserIdRounds");
      const selectDetails = document.getElementById("selectedUserIdDetails");

      if (selectRounds) {
        selectRounds.innerHTML = `<option value="">-- Ch·ªçn ·ª©ng vi√™n --</option>`;
        usersData.forEach(user => {
          selectRounds.innerHTML += `<option value="${user.id}">${user.fullname} (${user.email})</option>`;
        });
      }

      if (selectDetails) {
        selectDetails.innerHTML = `<option value="">-- Ch·ªçn ·ª©ng vi√™n --</option>`;
        usersData.forEach(user => {
          selectDetails.innerHTML += `<option value="${user.id}">${user.fullname} (${user.email})</option>`;
        });
      }
    }

    function renderUsers() {
      userList.innerHTML = usersData.map(user => `
        <tr>
          <td>${user.fullname}</td>
          <td>${user.email}</td>
          <td>${user.current_round <= 4 ? `V√≤ng ${user.current_round}` : "‚úÖ ƒê√£ ho√†n th√†nh"}</td>
          <td>${user.status || "Ch∆∞a c·∫≠p nh·∫≠t"}</td>
          <td>
            <button class="action-btn-small" onclick="editUser('${user.id}')">
              <i class="fas fa-edit"></i> Ch·ªânh s·ª≠a
            </button>
            <button class="action-btn-small" onclick="viewProfile('${user.id}')" style="background: var(--success);">
              <i class="fas fa-eye"></i> Xem profile
            </button>
          </td>
        </tr>
      `).join("");
    }

    window.editUser = async function (uid) {
      const user = usersData.find(u => u.id === uid);
      const name = prompt("H·ªç t√™n:", user.fullname);
      const email = prompt("Email:", user.email);
      if (name && email) {
        try {
          await updateDoc(doc(db, "users", uid), { fullname: name, email });
          loadUsers();
          alert("ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin ·ª©ng vi√™n!");
        } catch (error) {
          console.error("L·ªói c·∫≠p nh·∫≠t:", error);
          alert("Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t th√¥ng tin ·ª©ng vi√™n.");
        }
      }
    };

    window.viewProfile = function(uid) {
      // Gi·∫£ l·∫≠p c√°ch m·ªü profile ·ª©ng vi√™n
      const user = usersData.find(u => u.id === uid);
      if (user) {
        alert(`B·∫°n ƒëang xem profile c·ªßa: ${user.fullname}\n\n` +
              `V√≤ng hi·ªán t·∫°i: ${user.current_round <= 4 ? `V√≤ng ${user.current_round}` : "ƒê√£ ho√†n th√†nh"}\n` +
              `Email: ${user.email}\n\n` +
              `H√£y ki·ªÉm tra giao di·ªán profile ƒë·ªÉ xem chi ti·∫øt!`);
      }
    };

    window.renderSelectedRoundUser = function () {
      const uid = document.getElementById("selectedUserIdRounds").value;
      currentSelectedUser = uid;
      renderRounds(uid);
    };

    window.renderSelectedDetailUser = function () {
      const uid = document.getElementById("selectedUserIdDetails").value;
      renderRoundDetails(uid);
    };

    function renderRounds(uid) {
      const user = usersData.find(u => u.id === uid);
      if (!user) {
        roundsContainer.innerHTML = "<p class='no-data'>Vui l√≤ng ch·ªçn ·ª©ng vi√™n</p>";
        updateProfilePreview(null);
        return;
      }

      roundsContainer.innerHTML = `
        <div class="round-box">
          <h3 class="round-title"><i class="fas fa-user"></i> ${user.fullname}</h3>
          <div class="form-group">
            <label class="form-label">C·∫≠p nh·∫≠t v√≤ng hi·ªán t·∫°i:</label>
            <select class="select-box" onchange="changeRound('${user.id}', this.value)">
              ${[1, 2, 3, 4, 5].map(i => `
                <option value="${i}" ${i == user.current_round ? "selected" : ""}>
                  ${i <= 4 ? `V√≤ng ${i}: ${steps[i-1]}` : "‚úÖ ƒê√£ ho√†n th√†nh"}
                </option>
              `).join("")}
            </select>
          </div>
        </div>
      `;
      
      // C·∫≠p nh·∫≠t preview profile
      updateProfilePreview(user);
    }

    function renderRoundDetails(uid) {
      const user = usersData.find(u => u.id === uid);
      if (!user) {
        roundDetailContainer.innerHTML = "<p class='no-data'>Vui l√≤ng ch·ªçn ·ª©ng vi√™n</p>";
        return;
      }

      const roundsHTML = [1, 2, 3, 4].map(i => {
        const info = user[`round_${i}`] || {};
        return `
          <div class="round-box">
            <h3 class="round-title"><i class="fas fa-circle"></i> V√≤ng ${i}: ${steps[i - 1]}</h3>
            <div class="form-group">
              <label class="form-label">Th·ªùi gian:</label>
              <input type="text" class="input-box" value="${info.time || ''}" 
                     placeholder="VD: 15:00 - 17:00, Th·ª© 7 ng√†y 15/07/2023" 
                     id="time-${user.id}-${i}">
            </div>
            <div class="form-group">
              <label class="form-label">Ghi ch√∫:</label>
              <input type="text" class="input-box" value="${info.note || ''}" 
                     placeholder="Ghi ch√∫ cho ·ª©ng vi√™n" 
                     id="note-${user.id}-${i}">
            </div>
            <button class="save-btn" onclick="saveRound('${user.id}', ${i})">
              <i class="fas fa-save"></i> L∆∞u th√¥ng tin
            </button>
          </div>
        `;
      }).join("");
      roundDetailContainer.innerHTML = `<div>${roundsHTML}</div>`;
    }

    window.changeRound = async function(uid, value) {
      try {
        await updateDoc(doc(db, "users", uid), { current_round: parseInt(value) });
        loadUsers();
        alert("ƒê√£ c·∫≠p nh·∫≠t v√≤ng hi·ªán t·∫°i!");
        
        // C·∫≠p nh·∫≠t preview profile
        const user = usersData.find(u => u.id === uid);
        if (user) {
          user.current_round = parseInt(value);
          updateProfilePreview(user);
        }
      } catch (error) {
        console.error("L·ªói c·∫≠p nh·∫≠t:", error);
        alert("Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t v√≤ng hi·ªán t·∫°i.");
      }
    };

    window.saveRound = async function(uid, round) {
      const time = document.getElementById(`time-${uid}-${round}`).value;
      const note = document.getElementById(`note-${uid}-${round}`).value;
      
      try {
        await updateDoc(doc(db, "users", uid), {
          [`round_${round}`]: { time, note }
        });
        alert("ƒê√£ l∆∞u th√¥ng tin v√≤ng th√†nh c√¥ng!");
        
        // C·∫≠p nh·∫≠t preview profile
        const user = usersData.find(u => u.id === uid);
        if (user) {
          user[`round_${round}`] = { time, note };
          updateProfilePreview(user);
        }
      } catch (error) {
        console.error("L·ªói l∆∞u v√≤ng:", error);
        alert("Kh√¥ng th·ªÉ l∆∞u th√¥ng tin v√≤ng.");
      }
    };

    window.showTab = function(tabId) {
      // ·∫®n t·∫•t c·∫£ c√°c tab
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // ·∫®n t·∫•t c·∫£ c√°c n√∫t tab
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Hi·ªÉn th·ªã tab ƒë∆∞·ª£c ch·ªçn
      document.getElementById(tabId).classList.add('active');
      
      // K√≠ch ho·∫°t n√∫t tab
      event.currentTarget.classList.add('active');
    };

    window.login = async function() {
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value;
      
      if (!email || !password) {
        alert("Vui l√≤ng nh·∫≠p email v√† m·∫≠t kh·∫©u.");
        return;
      }
      
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        // ƒêƒÉng nh·∫≠p th√†nh c√¥ng
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("adminContent").style.display = "block";
        loadUsers();
      } catch (error) {
        console.error("L·ªói ƒëƒÉng nh·∫≠p:", error);
        alert("ƒêƒÉng nh·∫≠p th·∫•t b·∫°i. Vui l√≤ng ki·ªÉm tra email v√† m·∫≠t kh·∫©u.");
      }
    };

    window.logout = async function() {
      try {
        await signOut(auth);
        document.getElementById("loginBox").style.display = "block";
        document.getElementById("adminContent").style.display = "none";
        // Reset form
        document.getElementById("loginForm").reset();
      } catch (error) {
        console.error("L·ªói ƒëƒÉng xu·∫•t:", error);
      }
    };

    // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p khi t·∫£i trang
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // Ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("adminContent").style.display = "block";
        loadUsers();
      } else {
        // Ng∆∞·ªùi d√πng ch∆∞a ƒëƒÉng nh·∫≠p
        document.getElementById("loginBox").style.display = "block";
        document.getElementById("adminContent").style.display = "none";
      }
    });

    // G√°n s·ª± ki·ªán ƒëƒÉng xu·∫•t cho n√∫t
    document.getElementById("logoutBtn").addEventListener("click", logout);
  </script>
</body>
</html>
